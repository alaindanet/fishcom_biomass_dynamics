---
title: Appendix
subtitle:
author: Alain Danet, Maud Mouchet, Loubna El Madouri, Elisa Thébault and Colin Fontaine (ordre non fixé)
date: \today 
output:
  bookdown::pdf_document2:
    fig_caption: true 
    keep_tex: true
    toc: true
fontsize: 12pt
header-includes:
   - \usepackage{natbib}
   - \newcommand{\beginsupplement}{\renewcommand{\thetable}{S\arabic{table}} \setcounter{figure}{0} \renewcommand{\thefigure}{S\arabic{figure}}} 
   - \usepackage{float}
   - \usepackage[table]{xcolor}
   - \usepackage{multirow}
   - \usepackage{booktabs}
   - \usepackage{makecell}
   - \usepackage{setspace}
   - \doublespacing
   - \usepackage{lineno}
   - \linenumbers
geometry: margin=2cm
bibliography: references.bib
number_sections: true
---


```{r, echo=FALSE}
knitr::opts_chunk$set(
  cache = FALSE,
  collapse = TRUE,
  comment = "#>",
  #fig.dim = c(7, 7),
  fig.align = "center",
  fig.fullwidth = TRUE,
  fig.show = "hold",
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  results = TRUE
)
```


```{r, echo=FALSE, message=FALSE, results="hide"}
library(drake)
library(tidyverse)
library(magrittr)
library(ggeffects)
library(cowplot)
library(kableExtra)
library(sf)
library(nlme)

mypath <- rprojroot::find_package_root_file
source(mypath("R/variable_shortcut.R")) # Define your custom code as a bunch of
#functions.

source(mypath("R/misc.R"))
source_dir(mypath("R")) # Define your custom code as a bunch of functions.

mytheme <- theme_cowplot() +
  background_grid()

theme_set(mytheme)
options(knitr.table.format = "latex")
```
```{r}
var_analysis <- c("ct_ff", "w_trph_lvl_avg", "log_rich_std", "log_bm_std",
  "piel_bm", "piel_nind")
```

\beginsupplement
\newpage

# Data exploration


```{r}
loadd(p_st_mono_trends_stable_rich_bm, st_mono_trends_stable_rich_bm)

```


```{r}
range_cap <- paste0(
  "Range of variation of variables in spatial (vertical lines) and temporal
  dataset for the (A) minimum and maximum values and (B) the range (i.e. maximum
    - minimum)."
)
```


```{r range, fig.cap=range_cap, fig.height=10}
loadd(p_range)
plot_grid(plotlist = p_range, nrow = 2, labels = "AUTO")
```

\newpage

## Correlation


```{r}
cor_cap <- paste0("Correlation plot among variables.", "Median values over time were
  used for spatial relationships. ", "For temporal model, we used the
  temporal trends in each station. Futhermore, each station was weighted by the
  average error standard on the temporal trends of the variables.",
  " Pisc: piscivorous, Nb: number, node: node of the food-web corresponding to a
  trophic species, prop: proportion."
)
```


```{r cor, fig.cap=cor_cap}
oldpar <- par()
loadd(corr_plot_med, corr_plot_tps)

rv <- var_replacement()
rv_more <- c(
  nbnode_std = "Nb node",
  nb_pisc_rich_std = "Nb pisc species",
  nb_pisc_node_std = "Nb pisc nodes",
  prop_pisc_node = "Prop pisc node",
  prop_pisc_rich = "Prop pisc species"
)

rv <- c(rv_more, rv[!names(rv) == "rich_std"])

set_names_corr <- function(mat = NULL, replacement_vector = var_replacement()) {
  colnames(mat) <- str_replace_all(colnames(mat), replacement_vector)
  rownames(mat) <- str_replace_all(rownames(mat), replacement_vector)
  return(mat)
}

corr_plot_tps %<>% set_names_corr(., replacement_vector = rv)
corr_plot_med %<>% set_names_corr(., replacement_vector = rv)

#par(mfrow = c(1, 2))
corrplot::corrplot(
  corr_plot_med,
  type = "upper",
  diag = FALSE,
  order = "alphabet",
  tl.srt = 30,
  tl.cex = .7
)
title("Spatial", adj = 0, line = 3)
corrplot::corrplot(corr_plot_tps, type = "upper", diag = FALSE, order =
  "alphabet",
  tl.srt = 30,
  tl.cex = .7
)
title("Temporal trends", adj = 0, line = 3.2)
```

\newpage

# Statistical analysis

## Proportion and number of piscivorous species 

```{r}
loadd(rigal_classification, st_mono_trends_stable_rich_bm, full_data2)
full_data2 %>%
  select(richness, nb_pisc_rich, nb_non_pisc_rich)
unique(rigal_classification$variable)
var_pisc_mod <- c("nb_pisc_rich_std", "prop_pisc_rich", "nb_non_pisc_rich_std",
    "prop_non_pisc_rich",
      "log_rich_std", "log_bm_std")
pisc_data <- map(var_pisc_mod,
    function(x, var_to_keep, classif_var) {

      x_data <- classif_var[classif_var$variable == x, ] %>%
	unnest(classif)
      x_data <- x_data[, colnames(x_data) %in% var_to_keep]

      # Rename according to the variable
      colnames(x_data)[colnames(x_data) %in% var_to_keep[2:3]] <-
	paste0(x, c("", "_strd_error"))
      return(x_data)

    },
    var_to_keep = c("station", "linear_slope", "linear_slope_strd_error"),
  classif_var = rigal_classification) %>%
  Reduce(merge.all, .) %>%
  filter(station %in% st_mono_trends_stable_rich_bm) %>%
  na.omit()

# for standardized coefficients 
pisc_data_scaled <- pisc_data %>%
  mutate(across(all_of(var_pisc_mod), ~ scale(., center = FALSE)[,1]))

pisc_mod_std <- tibble(
  response = c("nb_pisc_rich_std", "nb_non_pisc_rich_std", "prop_pisc_rich", "prop_non_pisc_rich"),
  mod = list(
    lm(
      nb_pisc_rich_std ~ log_bm_std + log_rich_std,
      data = pisc_data_scaled,
      weight = 1 / (log_rich_std_strd_error + log_bm_std_strd_error +
        nb_pisc_rich_std_strd_error)
      ),
    lm(
      nb_non_pisc_rich_std ~ log_bm_std + log_rich_std,
      data = pisc_data_scaled,
      weight = 1 / (log_rich_std_strd_error + log_bm_std_strd_error +
        nb_non_pisc_rich_std_strd_error)
      ),
    lm(
      prop_pisc_rich ~ log_bm_std + log_rich_std,
      data = pisc_data_scaled,
      weight = 1 / (log_rich_std_strd_error + log_bm_std_strd_error +
        prop_pisc_rich_strd_error)
      ),
    lm(
      prop_non_pisc_rich ~ log_bm_std + log_rich_std,
      data = pisc_data_scaled,
      weight = 1 / (log_rich_std_strd_error + log_bm_std_strd_error +
        prop_non_pisc_rich_strd_error)
      )
  )
  )

pisc_mod_std <- pisc_mod_std %>%
  mutate(
    coefs = map(mod, broom::tidy),
    perf = map(mod, broom::glance) 
  )

pisc_mod_std %>%
  select(response, coefs) %>%
  unnest(coefs)
```


## Spatial model

```{r}
loadd(est_sp_models, colin_sp_models, sp_models)
```

```{r}
tmp <- map(colin_sp_models, enframe)
t_colin_sp_models <- tibble(vif = tmp, mod = names(colin_sp_models)) %>%
  unnest(vif) %>%
  filter(name %in% c("log_rich_std", "log_bm_std", "ct_ff"), mod == "log_rich_std") %>% #same model for
  #all, so the vif is the same
  rename(Response = name, vif = value) %>%
  select(-mod) %>%
  mutate(vif = map(vif, enframe)) %>%
  unnest(vif) %>%
  mutate(
    value = round(value, 3),
    name = str_replace_all(name, var_replacement()),
    Response = str_replace_all(
      Response,
      c("log_rich_std" = "Richness model", "log_bm_std" = "Biomass model",
	"ct_ff" = "Food-web structure"))
    ) %>%
  spread(name, value)


# colinearity table
kable(t_colin_sp_models,
  row.names = FALSE,
  booktabs = T,
  caption = "Variance Inflation Factor for the linear models in the spatial
  models. NA values indicate that the term in column was not included in the
  modeling of the response variable in row.",
  label = "vif-sp",
  ) %>%
  kable_styling(latex_options = c("scale_down", "stripped"))
```

## Sensisivity analysis for the temporal model

```{r}
loadd(
  resume_bm_rich_mod_mono_trends,
  model_bm_rich_no_covar_no_inc_mono_trends,
  reg_table_bm_rich_mono_trends,
  reg_table_bm_rich_mono_stable_trends,
  reg_table_bm_rich_trends,
  reg_table_bm_rich,
  anova_table_bm_rich_mono_trends,
  anova_table_bm_rich_mono_stable_trends,
  anova_table_bm_rich_trends,
  anova_table_bm_rich,
  anova_bm_rich_mod
)
loadd(
  st_trends_rich_bm,
  st_mono_trends_rich_bm,
  st_mono_trends_stable_rich_bm,
  basin_station
)
loadd(
  pred_bm_rich_mono_trends,
  pred_bm_rich,
  pred_bm_rich_trends,
  pred_bm_rich_mono_stable_trends
)
```

```{r}
cap_sens_temp_model <- paste0("
  Testing the robustness of the estimated coefficients to the selection of
  sites. 'All trends' corresponds to all the sites, 'Only monotonuous trends'
  corresponds to all the trends negative or positive monotonically, 'Monotonuous
  + stable' includes the previous selection and the stable ones (the selection
    used in main text), 'All significant trends' correspond to all the trends
significantly negative or positive.", " We classified a site as
  having a significant trend when it displays both significant trends in biomass
and in species richness."
)
```
```{r sens, out.width="100%", fig.cap=cap_sens_temp_model}
# Merge reg_table
merged_reg_table <- pmap_dfr(
  list(
    df = list(
      reg_table_bm_rich_mono_trends,
      reg_table_bm_rich_mono_stable_trends,
      reg_table_bm_rich_trends,
      reg_table_bm_rich
      ),
    name = list(
      "Only monotonuous",
      "Monotonuous + stable (used in main text)",
      "All significant trends",
      "All sites"
      ),
    st = list(
      st_mono_trends_rich_bm,
      st_mono_trends_stable_rich_bm,
      st_trends_rich_bm,
      seq(1,400)
    )
    ), function (df, name, st) {
    df$selection <- paste0(name, " (N = ", length(st),")")
    return(select(df, selection, everything()))
  }
)

merged_reg_table %>%
  filter(! term %in% "(Intercept)", ! response %in% "piel_nind") %>%
  mutate(
   response = str_replace_all(response, var_replacement()),
   term = str_replace_all(term, var_replacement()),
  ) %>%
  ggplot(aes(x = term, y = std_estimate)) +
  geom_point(aes(color = selection)) +
  facet_grid(cols = vars(response)) +
  labs(
    x = "Explicative variable",
    y = "Standardized coefficients"
  ) +
  theme(
    legend.position = "bottom",
    axis.text.x = element_text(hjust = 1, angle = 15, size = 8),
    text = element_text(size = 8)) +
  guides(color = guide_legend(nrow = 2, byrow = TRUE))
```

We found that selection of data can have either low or high effects on estimated
effects. When selecting only the sites that display significant decrease or
increase of community biomass and species richness across time, i.e. 
a tenth of the site, we found stronger links among the temporal dynamics of
average trophic level, connectance, biomass and the temporal dynamics of biomass
and species richness (Fig. \@ref(fig:sens), purple and red points). On the other
side, we found that the data selection that we used in the main analysis
displays roughly the same results that the selection that includes all sites
(Fig. \@ref(fig:sens), blue and green points).

The fact that we observed differences with data selection is that  "Only
monotonuous" and "All significant trends" do not contain temporal dynamics
around 0 because they are often non significant. We think that this data
selection is not satisfactory because we wanted to include the temporal dynamics
of biomass of species richness that were not significant, i.e. that can be
considered as stable. The rational is that we wanted to know what was the
expected temporal trends of food-web structure while the ones of biomass and
species richness are kept stable. Without those data, the regression becomes
constrained only by the extreme temporal trends of species richness and
community biomass.

\newpage

## Interaction between community biomass trends and species richness trends

```{r}
loadd(model_bm_rich_int_mono_stable_trends)
```

```{r}
model_bm_rich_int_mono_stable_trends %>%
  .[names(.) %in% c("ct_ff", "w_trph_lvl_avg", "piel_bm")] %>%
  map(., car::Anova) %>%
  map(., tidy) %>%
  map2_dfr(., names(.), ~.x %>% mutate(response = .y) %>% select(response,
      everything())) %>%
  mutate(
    response = str_replace_all(response, var_replacement()),
    term = str_replace_all(term, var_replacement())
  ) %>%
  rename_all(~str_to_title(.)) %>%
  kable(., booktabs = TRUE,
  row.names = FALSE,
  caption =
    paste0(
      "ANOVA results with interactions."
      ),
    label = "aov-int"
    ) %>%
kable_styling(latex_options =c("scale_down", "stripped")) %>%
collapse_rows(columns = 1, valign = "top")
#map(model_bm_rich_int_mono_stable_trends, ~try(car::vif(.x)))
```

```{r}
model_bm_rich_int_mono_stable_trends %>%
  .[names(.) %in% c("ct_ff", "w_trph_lvl_avg", "piel_bm")] %>%
  map(., tidy) %>%
  map2_dfr(., names(.), ~.x %>% mutate(response = .y) %>% select(response,
      everything())) %>%
  mutate(
    response = str_replace_all(response, var_replacement()),
    term = str_replace_all(term, var_replacement())
  ) %>%
  rename_all(~str_to_title(.)) %>%
  kable(., booktabs = TRUE,
  row.names = FALSE,
  caption =
    paste0(
      "Regression results of the model with interactions between the temporal
      dynamics of community biomass and the one of species richness."
      ),
    label = "reg-int"
    ) %>%
kable_styling(latex_options =c("scale_down", "stripped")) %>%
collapse_rows(columns = 1, valign = "top")
```


```{r, results="hide", echo=FALSE}
pred_int_rich <- map(model_bm_rich_int_mono_stable_trends,
      ~ggpredict(.x,
        terms = c("log_rich_std", "log_bm_std [quart2]")) %>%
        as_tibble() %>%
        mutate(group = as.numeric(as.character(group))) %>%
        rename("log_rich_std" = x, "log_bm_std" = group)
        ) %>%
enframe(name = "response", value = "pred_int")

ti <- pred_bm_rich_mono_stable_trends %>%
  filter(
    term == "log_rich_std",
    response %in% c("ct_ff", "w_trph_lvl_avg", "piel_bm")
    ) %>%
  select(response, raw_plot) %>%
  left_join(pred_int_rich) %>%
  mutate(pred_plot_color = pmap(
      list(raw_plot, response, pred_int),
      function(p, resp, pred, ...) {
        p +
          geom_line(data = pred,
            aes(
              y = predicted,
              x = log_rich_std,
              color = as.factor(log_bm_std)
            ), size = 1
          ) +
        scale_color_discrete() +
        labs(x = "Log species richness",
          y = var_replacement()[resp],
          color = "Log community biomass"
          ) +
        theme(
          text = element_text(size = 8),
          axis.text = element_text(size = 8)
        )
      }
        )
  )
rich_leg <- get_legend(ti$pred_plot_color[[1]])
```

```{r}
int_rich_cap <- paste0(
  "Relationships between the temporal dynamics of food-web
  structure and the one of species richness. The interaction between
  the temporal dynamic of species richness and community biomass is significant
  for the three descriptors of food-web structure. The chosen values for the
  community biomass temporal dynamic correspond respectively to the first,
  second and third quartiles.
  ")

```


```{r int-rich, fig.cap=int_rich_cap}
plot_grid(plotlist = 
  map(ti$pred_plot_color,
    ~.x + theme(
      legend.position = "none",
    )
    ),
rich_leg)
```


```{r eval = FALSE}
test <- pred_int_rich[3, ]$pred_int[[1]] %>%
  select(predicted, log_rich_std, log_bm_std) %>%
  arrange(log_rich_std, log_bm_std)

mat <- reshape2::acast(test, log_rich_std~log_bm_std, value.var = "predicted")
library(plotly)
plot_ly(
  x = ~as.numeric(colnames(mat)),
  y = ~as.numeric(rownames(mat)),
  z = ~mat) %>%
  add_surface()
```

```{r, results="hide", echo=FALSE}
pred_int_bm <- map(model_bm_rich_int_mono_stable_trends,
      ~ggpredict(.x,
        terms = c("log_bm_std", "log_rich_std [quart2]")) %>%
        as_tibble() %>%
        mutate(group = as.numeric(as.character(group))) %>%
        rename("log_bm_std" = x, "log_rich_std" = group)
        ) %>%
enframe(name = "response", value = "pred_int")

ti_bm <- pred_bm_rich_mono_stable_trends %>%
  filter(term == "log_bm_std", response %in% c("ct_ff", "w_trph_lvl_avg", "piel_bm")) %>%
  select(response, raw_plot) %>%
  left_join(pred_int_bm) %>%
  mutate(pred_plot_color = pmap(
      list(raw_plot, response, pred_int),
      function(p, resp, pred) {
        p +
          geom_line(data = pred,
            aes(
              y = predicted,
              x = log_bm_std,
              color = as.factor(log_rich_std)
            ), size = 1
          ) +
        scale_color_discrete() +
                labs(x = "Log species richness",
          y = var_replacement()[resp],
          color = "Log community biomass"
          ) +
        theme(
          text = element_text(size = 8),
          axis.text = element_text(size = 8)
        )

      }
      )
  )
bm_leg <- get_legend(ti_bm$pred_plot_color[[1]])
```

```{r}
int_bm_cap <- paste0(
  "Relationships between the temporal dynamics of food-web
  structure and the one of community biomass. The interaction between
  the temporal dynamics of species richness and community biomass is significant
  for the three descriptors of food-web structure. The chosen values for the
  species richness temporal dynamic correspond respectively to the first,
  second and third quartiles.
  "
)
```

```{r int-bm, fig.cap=int_bm_cap}
plot_grid(plotlist = map(ti_bm$pred_plot_color, ~.x + theme(legend.position = "none")), bm_leg)
```


```{r, echo=FALSE, results="hide"}
test <- model_bm_rich_int_mono_stable_trends[["ct_ff"]]
car::Anova(test)
co <- coef(test)
pred <- ggpredict(
  test,
  terms = c("log_bm_std ", "log_rich_std")
  ) %>%
  as_tibble() %>%
  mutate(group = as.numeric(as.character(group))) %>%
  rename("log_bm_std" = x, "log_rich_std" = group)

pred$y <- co[1] +
 # co["log_rich_std"] * pred[["log_rich_std"]] + bc not significant
  co["log_bm_std"] * pred[["log_bm_std"]] +
  co["log_rich_std:log_bm_std"] * pred[["log_rich_std"]] * pred[["log_bm_std"]]

# all.equal(pred$y, pred$predicted)

mat <- reshape2::acast(pred, log_rich_std~log_bm_std, value.var = "y")
library(plotly)
p <- plot_ly(
  x = ~as.numeric(colnames(mat)),
  y = ~as.numeric(rownames(mat)),
  z = ~mat, ) %>%
  add_surface() %>%
  layout(scene = list(
      xaxis = list(title = "species richness"),
      yaxis = list(title = "Community biomass"),
      zaxis = list(title = "Connectance")
      ))
```

```{r, results=FALSE}
mod4_3d <- model_bm_rich_int_mono_stable_trends[
  names(model_bm_rich_int_mono_stable_trends) %in%
    c("ct_ff", "w_trph_lvl_avg")]

pred_list <- map(mod4_3d,
  function (modl, p) {
    co <- coef(modl)
    p$y <- co[1] +
#      co["log_rich_std"] * p[["log_rich_std"]] +
      co["log_bm_std"] * p[["log_bm_std"]] +
      co["log_rich_std:log_bm_std"] * p[["log_rich_std"]] * p[["log_bm_std"]]
    return(p)

  }, p = pred)
```

```{r,results=FALSE}
mat <- reshape2::acast(
  pred_list$w_trph_lvl_avg,
  log_rich_std~log_bm_std,
  value.var = "y")
p <- plot_ly(
  x = ~as.numeric(colnames(mat)),
  y = ~as.numeric(rownames(mat)),
  z = ~mat, ) %>%
  add_surface() %>%
  layout(scene = list(
      xaxis = list(title = "Community biomass"),
      yaxis = list(title = "species richness"),
      zaxis = list(title = "Avg trophic level")
      ))
```

```{r,results=FALSE, eval=FALSE}
test <- model_bm_rich_int_mono_stable_trends[["piel_bm"]]
car::Anova(test)
co <- coef(test)
pred <- ggpredict(
  test,
  terms = c("log_bm_std ", "log_rich_std")
  ) %>%
  as_tibble() %>%
  mutate(group = as.numeric(as.character(group))) %>%
  rename("log_bm_std" = x, "log_rich_std" = group)

pred$y <- co[1] +
  co["log_rich_std"] * pred[["log_rich_std"]] +
  co["log_bm_std"] * pred[["log_bm_std"]] +
  co["log_rich_std:log_bm_std"] * pred[["log_rich_std"]] * pred[["log_bm_std"]]

# all.equal(pred$y, pred$predicted)

mat <- reshape2::acast(pred, log_rich_std~log_bm_std, value.var = "y")
p <- plot_ly(
  x = ~as.numeric(colnames(mat)),
  y = ~as.numeric(rownames(mat)),
  z = ~mat, ) %>%
  add_surface() %>%
  layout(scene = list(
      xaxis = list(title = "species richness"),
      yaxis = list(title = "Community biomass"),
      zaxis = list(title = "Eveness of biomass")
      ))
```

```{r}
int_3d_cap <- paste0(
  "Tri-dimentional plot displaying the relationships among food-web structure
  from one side and the temporal dynamics of species richness and community
  biomass from the other side. The surface represents the values predicted by
  the model."
)
```

```{r int-3d, fig.cap=int_3d_cap}
p_ct_ff <- ggdraw() +
    draw_image(get_mypath("figures", "int_rich_bm_cf_ff.png"), scale = 1)
p_tlvl <- ggdraw() +
    draw_image(get_mypath("figures", "int_rich_bm_tlvl.png"), scale = 1)
p_piel_bm <- ggdraw() +
    draw_image(get_mypath("figures", "int_rich_bm_eveness.png"), scale = 1)
plot_grid(
  p_ct_ff,
  p_tlvl,
  p_piel_bm,
  labels = "AUTO"
)
```

All together, we found that interactions between the temporal dynamics of
community biomass and species richness have no major effects on the bivariate
relationships (Fig. \@ref(fig:int-bm) and \@ref(fig:int-rich)), at least in
the range of values observed in the dataset (1st to 3rd quartiles).  It is more
complicated for connectance when exploring the full range of possible values
(Fig. \@ref(fig:int-3d) A). We found that connectance strongly decrease with
increasing of community biomass temporal trends when species richness temporal
trends is strongly negative, while we found the opposite when species richness temporal
trends is strongly positive. Furthermore we found that the temporal dynamic of
connectance had a strong positive relationship with the one of species richness
when community biomass increases through time while we found no relationship
when the temporal trend of community biomass was strongly negative.

- Results for interactions: 
  - Connectance: 
    - Always decreases when richness decreases (inverse of expectation)
    - Increases when richness increases (inverse of expectation), but always
      decreases if biomass decreases
    - Increases when biomass increases
  - Average trophic level:
    - Always decreases when biomass decreases 
    - Always increases when biomass increases 
    - Whatever the richness dynamics, it is the biomass dynamics which drives
      all
  - Pielou of biomass:
    - Always positive when biomass decreases
    - Always negative when biomass increases 
    - Whatever the richness dynamics, it is the biomass dynamics which drives
      all

```{r}
template_cross <- tibble(
  bm_std = c("-", "0", "+"),
  `-` = c(NA, NA, NA),
  `0` = c(NA, NA, NA),
  `+` = c(NA, NA, NA),
  )

ct_ff_cross_table <- tibble(
  rich_std = c("-", "0", "+", "sign_relationship"),
  `-` = c("-", "-", "--", "-"),
  `0` = c("-", "-", "-", "0"),
  `+` = c("-", "+", "++", "+"),
  "sign_relationship" = c("0", "+", "+", "")
  )

kable(ct_ff_cross_table) %>%
  add_header_above(c(" " = 1, "bm_std" = 3))
```

```{r}
tlvl_cross_table <- tibble(
  rich_std = c("-", "0", "+", "sign_relationship"),
  `-` = c("-", "0", "+", "+"),
  `0` = c("-", "0", "+", "+"),
  `+` = c("-", "0", "+", "+"),
  "sign_relationship" = c("+", "0", "-", "")
  )

kable(tlvl_cross_table) %>%
  add_header_above(c(" " = 1, "bm_std" = 3))
```

\newpage

## Statistical model tables 

### Temporal

```{r}
loadd(
  pred_bm_rich_mono_stable_trends,
  model_bm_rich_int_mono_stable_trends,
  model_bm_rich_int_mono_stable_trends,
  rsq_table_bm_rich_mono_stable_trends
)
```


```{r}
reg_table_bm_rich_mono_stable_trends %>%
  mutate(
    response = str_replace_all(response, var_replacement()),
    term = str_replace_all(term, var_replacement())
    ) %>%
kable(., booktabs = TRUE,
  row.names = FALSE,
  caption =
    paste0(
      "Regression coefficients for the linear models explaining the links
      between the temporal trends of community biomass and the temporal trends
      of the network structure."),
      label = "reg"
      ) %>%
  kable_styling(latex_options = c("scale_down", "striped")) %>%
  collapse_rows(columns = 1, valign = "top")
```



```{r}
table_rsq_tps <- rsq_table_bm_rich_mono_stable_trends %>%
  mutate(
    Response = str_replace_all(Response, var_replacement())
  )
table_rsq_tps %>%
  kable(., booktabs = TRUE,
    caption =
      paste0(
      "Marginal and conditional squared R for temporal models."),
  label = "rsq"
      ) %>% #
  kable_styling(latex_options = c("striped")) %>%
  collapse_rows(columns = 1, valign = "top")
```


### Spatial

```{r}
loadd(
  sp_anova_table_bm_rich_mono_stable_trends,
  sp_rsq_table_bm_rich_mono_stable_trends
)
```


```{r}
sp_anova_table_bm_rich_mono_stable_trends %>%
  mutate(
    response = str_replace_all(response, var_replacement()),
    term = str_replace_all(term, var_replacement()),
  ) %>%
  kable(.,
    booktabs = TRUE,
    row.names = FALSE,
    caption =
      paste0(
      "ANOVA results for the links among the spatial variation of community
      biomass and species richness and the one of network structure."),
  label = "aov-sp"
  ) %>%
  kable_styling(latex_options = c("scale_down", "striped")) %>%
  collapse_rows(columns = 1, valign = "top")
```

```{r}
sp_rsq_table_bm_rich_mono_stable_trends %>%
  mutate(
    Response = str_replace_all(Response, var_replacement())
  ) %>%
  kable(., booktabs = TRUE,
    caption =
      paste0("Marginal and conditional $R^2$ for the spatial models."),
  label = "rsq-sp"
      ) %>% #
  kable_styling(latex_options = c("striped")) %>%
  collapse_rows(columns = 1, valign = "top")
```

