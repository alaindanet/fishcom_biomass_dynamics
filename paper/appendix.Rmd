---
title: Appendix
subtitle:
author: Alain Danet, Loubna El Madouri, Maud Mouchet, Elisa ThÃ©bault and Colin Fontaine
date: \today
output:
  bookdown::pdf_document2:
    fig_caption: true
    keep_tex: true
    toc: false
fontsize: 10pt
header-includes:
   - \usepackage{natbib}
   - \newcommand{\beginsupplement}{\renewcommand{\thetable}{S\arabic{table}} \setcounter{figure}{0} \renewcommand{\thefigure}{S\arabic{figure}}}
   - \usepackage{float}
   - \usepackage{multirow}
   - \usepackage{booktabs}
   - \usepackage{makecell}
   - \usepackage{setspace}
   - \doublespacing
   - \usepackage{lineno}
   - \linenumbers
   - \renewcommand{\arraystretch}{1}
geometry: margin=2cm
bibliography: references.bib
number_sections: false
---


```{r, echo=FALSE}
knitr::opts_chunk$set(
  cache = FALSE,
  collapse = TRUE,
  comment = "#>",
  #fig.dim = c(7, 7),
  fig.align = "center",
  fig.fullwidth = TRUE,
  fig.show = "hold",
  fig.pos = "H",
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  results = TRUE
)
options(
  #kableExtra.latex.load_packages = FALSE,
  knitr.table.format = "latex",
  knitr.graphics.rel_path = FALSE
)
```


```{r, echo=FALSE, message=FALSE, results="hide"}
library(targets)
library(tidyverse)
library(magrittr)
library(ggeffects)
library(cowplot)
library(kableExtra)
library(sf)
library(nlme)

mypath <- rprojroot::find_package_root_file
source(mypath("R/variable_shortcut.R")) # Define your custom code as a bunch of
#functions.

source(mypath("R/misc.R"))
source_dir(mypath("R")) # Define your custom code as a bunch of functions.

mytheme <- theme_cowplot() +
  background_grid()

theme_set(mytheme)
```

\beginsupplement

# Supplementary figures {-}


```{r}
tps10_cap <- paste0("Distribution of temporal trends per decade of the food-web
  structure by site estimated from the Bayesian models using Best Linear
  Unbiaised Prediction (BLUP). Species richness and biomass temporal trends are
  reported in percentage change per decade. Dashed red line and solid black line
  respectively indicate 0 and median change.")

```

```{r tps10, fig.cap=tps10_cap}
tar_load(figStps10)
knitr::include_graphics(figStps10)
```


```{r}
cor_cap <- paste0("Correlation among food-web metrics for a) temporal trends by
  site, b) median values by site (cf Main Methods)", " Pisc: piscivorous, rich.:
species richness, node: node of the food-web corresponding to a trophic species,
prop.: proportion."
)
```


```{r cor, fig.cap=cor_cap}
tar_load(figcorr)
knitr::include_graphics(figcorr)
```

```{r}
sem_sp_mod_cap <- "Direct effects of biomass and species richness on food-web
structure, derived from the structural equation models for the (a) spatial and
(b) bioenergetic model. Points display the data, black lines display the
predicted relationships."

```

```{r, fig.cap=sem_sp_mod_cap, out.width = "100%"}
tar_load(p_sem_sp_sim_file)
knitr::include_graphics(p_sem_sp_sim_file)
```


```{r}
rand_sim_cap <- paste0(
  "Simulations of (a) species and (b) nodes extinctions in the metaweb according
  to three scenarios: random extinction sequence, extinction sequence by decreasing order of trophic level,
 extinction sequence by increasing order of trophic level. The black line
 represents the prediction of a GAM model for the random extinction sequences (N = 50)."
)
```

```{r ext, fig.cap=rand_sim_cap}
tar_load(figSext)
knitr::include_graphics(figSext)
```




```{r}
obs_fit_cap <- "Fitted versus observed values from the INLA models estimating
the temporal trends of the food-web structure. The black line depicts the first
bissector. Pearson's correlation coefficients are displayed."
```


```{r, fig.cap=obs_fit_cap}
tar_load(figSobsfit)
knitr::include_graphics(figSobsfit)
```

\pagebreak
\newpage


# Supplementary tables {-}

\pagebreak

```{r}
tar_load(c(op_table, com_metric_tab))
tab_quanti <- purrr::map_dfr(
  list(com_metric_tab, op_table),
  function(x) {colnames(x)[1] <- "Variable"; x}
)
tab_quanti %>%
  kbl(
    caption = "Summary distribution of community metrics and fish monitoring variables.",
    booktabs = T
    ) %>%
  kable_styling() %>%
  pack_rows("Community metrics", 1, 8) %>%
  pack_rows("Summary of fish monitoring", 9, 13)
```

```{r}
tar_load(r2_inla_tab)
kable(r2_inla_tab,
  row.names = FALSE,
  booktabs = T,
  caption = "Marginal and Conditional R-squared for the INLA models estimating
  the temporal trends of the food-web structure. Mean [95\\% Credible Interval].",
  label = "inlarsq") %>%
  kable_styling()
```

```{r}
tar_load(semeff_tot_tab)
ti <- semeff_tot_tab %>%
  pivot_wider(names_from = "Effect type", values_from = "Effect") %>%
  mutate(Response = factor(Response, levels = unique(var_replacement()))) %>%
  arrange(Model, Response)
kable(ti %>%
    select(-Model),
  row.names = FALSE,
  booktabs = T,
  caption = "Direct and total Standardized effects derived from the structural
  equation models. [95\\% Confidence Interval]. The confidence intervals were
  obtained with bootstrap (see Methods).") %>%
  collapse_rows(columns = c(1), valign = "top") %>%
  pack_rows(index = table(ti$Model))
```

```{r}
tar_load(r2_sem_tab)
kable(r2_sem_tab %>%
  mutate(
    Type = factor(Type, levels = effect_type_var()),
    Response = factor(Response, levels = unique(var_replacement()))
    ) %>%
  arrange(Type, Response),
  row.names = FALSE,
  booktabs = T,
  caption = "Marginal and conditional R squared for the Structural Equation
  Models.",
  label = "r2sem",
  ) %>%
  kableExtra::collapse_rows(columns = 1, valign = "top")
```


```{r}
tar_load(tab_inla_rand)
tab_inla_rand %>%
  mutate(Response = factor(Response, levels = unique(var_replacement()))) %>%
  arrange(Response) %>%
  kable(
    row.names = FALSE,
    booktabs = T,
    caption = "Standard deviation associated to the random effects and the residual error of
    the models. Mean [95\\% Credible Interval].",
    label = "inlarand") %>%
  collapse_rows(columns = c(1), valign = "top") %>%
  kable_styling()
```


```{r}
tar_load(tabvif)
kable(tabvif,
  row.names = FALSE,
  booktabs = T,
  caption = "Variance Inflation Factor for the more complex linear models
  included in the Structural Equation Models.",
  label = "vif",
  )
```

