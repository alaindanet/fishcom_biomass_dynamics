---
title: "Community biomass and species richness temporal trends reveal contrasting assembly and disassembly processes in natural food-webs"
author: Alain Danet, Loubna El Madouri, Maud Mouchet, Elisa ThÃ©bault and Colin Fontaine
date: \today
output:
  bookdown::word_document2:
    fontsize: 12pt
  bookdown::pdf_document2:
    fig_caption: true 
    keep_tex: true
    toc: true
    fontsize: 12pt
    header-includes:
       - \usepackage{natbib}
       - \usepackage{float}
       - \usepackage{multirow}
       - \usepackage{booktabs}
       - \usepackage{makecell}
       - \usepackage{setspace}
       - \doublespacing
       - \usepackage{lineno}
       - \linenumbers
    geometry: margin=2cm
    number_sections: true
bibliography: references.bib
---

```{r, echo = FALSE}
knitr::opts_chunk$set(
  cache = FALSE,
  collapse = TRUE,
  comment = "#>",
  #fig.dim = c(7, 7),
  fig.fullwidth = TRUE,
  fig.show = "hold",
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  results = TRUE,
  fig.path="figures/"
)
```

- Tentative titles:
  - How food-webs assembly and disassembly through time in natural settings?
    Lessons from freshwater fishes
  - Relationships among temporal trends of food-web structure, species richness
    and community biomass reveal contrasting assembly
    and disassembly processes
  - Temporal trends in food web structure according to richness and biomass
    reveal contrasting assembly and disassembly processes  

```{r, results = FALSE}
library(targets)
library(tidyverse)
library(magrittr)
library(cowplot)
library(viridis)
library(kableExtra)
library(sf)
mypath <- rprojroot::find_package_root_file
source(mypath("R/variable_shortcut.R")) # Define your custom code as a bunch of functions.
source(mypath("R/misc.R"))
source_dir(get_mypath("R")) # Define your custom code as a bunch of functions.

mytheme <- theme_cowplot() +
background_grid()

theme_set(mytheme)
options(knitr.table.format = "latex")
```

```{r}
tar_load(full_data2)
nb_st <- unique(full_data2$station) %>% length
rm(full_data2)
```

# Abstract (250 words max)

# Signifiance (120 words)


# Introduction (564 words)

Global diversity is reported to decline at alarming rates [@]. At local scale,
recent meta-analysis reported a huge variation in species richness temporal
trends across various taxa and ecosystem types[@vellend_global_2013;
@dornelas_assemblage_2014; @blowes_geography_2019], with no net variations in
species richness[@dornelas_assemblage_2014; @blowes_geography_2019].
Futhermore, recent studies founs that temporal changes in species richness are
unrelated to changes in species composition[@dornelas_assemblage_2014;
@blowes_geography_2019], rising the recognition of the multidimensional nature
of biodiversity changes[@hillebrand_biodiversity_2018; @blowes_local_nodate]
and the need for further investigations on how biodiversity changes over time. 

Species interactions among species, described as ecological networks, drive for
a large part community composition, species coexistence, and ecosystem
functioning[@chesson_mechanisms_2000; @thebault_food-web_2003;
@oconnor_general_2017]. The structure of ecological networks can trigger or
impede perturbation propagations, i.e secondary extinctions[@paine_note_1969;
@dunne_network_2002; @srinivasan_response_2007;
@stouffer_compartmentalization_2011]. Higher connectance, which measures the
degree of generalism in a network, is predicted to increase robustness to
secondary extinctions[@dunne_network_2002; @sole_complexity_2001] and studies
found that higher trophic level was associated to a lower temporal variability
of community biomass in theoretical models and empirical
data[@shanafelt_stability_2018; @danet_species_2021]. Then, accounting for how
the structure of ecological networks changes over time according to other
biodiversity facets is crucial.

Th availability of ecological networks timeseries is
scarce[@kortsch_disentangling_2021], such as predictions about how the strucure
of ecological networks change according to changes in species richness come from
spatial comparison. Spatially, connectance has been shown to be negatively
related to species richness in small (i.e. below 20 species) empirical food-webs
[reviewed in @dunne_network_2006], which reflects constraints on the number of
realizable species interactions or an increasing proportion of specialists in
more rich foodwebs. Connectance has been shown to scale positively or negatively
with community biomass in theoretical food-webs[@thebault_food-web_2003;
@poisot_trophic_2013] while the average trophic level was previously shown to
scale negatively with species richness[@danet_species_2021]. 

However, predicting how ecological networks will change in time according to
other biodiversity facets based on spatial comparison of ecological communities
is valid as long as assumption of the space-for-time substitution is valid as
well. Space-for-time substitution supposes a homology between variations in
space and in time, i.e. that spatial sequences correspond to temporal sequences.
This method have raised criticisms[@damgaard_critique_2019], with studies
showing analogous patterns in space and time[@blois_space_2013] or not
[@johnson_testing_2008; @adler_contrasting_2007]. Spatial turnover of species
composition, dispersal limitation, disturbance and stochastic processes have
been hypothesised to be responsible for the non-compliance of space-for-time
substitution[@adler_contrasting_2007; @blois_space_2013].

The increasing availability ecological temporal series and the development of
methods to reconstruct food-webs[@bonnaffe_comparison_2021;
@gravel_inferring_2013; @danet_species_2021] makes possible to overcome
those research gaps. We used a standardized monitoring of fish riverine 
communities on the period 1995-2018 over France, documenting the individual size
of fishes in 400 sites during ten years or more. We restructed around 4000
food-webs based on allometric relationships and food diet data, and then
computed connectance, and average trophic level as well as community biomass and
species richness.

Our primary objective was to assess how the local structure of foodwebs changes
over time according to simultaneous changes in community biomass and species
richness over time. Our second objective was to assess if the relationships
between changes in food-web structure, community biomass and species richness,
are the same over space and over time, i.e. is the space-for-time substitution
valid?  To do so, we first assessed the temporal trends in food-web structure.
We then built structural equation model to assess the relationships among the
temporal trends of the different facets of food-web structure.



# Results

```{r}
tar_load(glob_tps_trends_decade_no_drivers)
gbm <- get_effect_ci(resp = "log_bm_std", ci_lvl = "level:0.80", p = TRUE)
gr <- get_effect_ci(resp = "log_rich_std", ci_lvl = "level:0.80", p = TRUE)
gt <- get_effect_ci(resp = "w_trph_lvl_avg", ci_lvl = "level:0.80", p = FALSE)
gct <- get_effect_ci(resp = "ct_ff", ci_lvl = "level:0.80", p = FALSE)
```

```{r}
tar_load(c(r2_inla_tab, r2_inla, r2_sem))
r2_inla_report <- r2_inla %>%
  select(response, r2_mvp_marg95hpdci, r2_mvp_cond95hpdci)
r2ic <- map(
  setNames(r2_inla_report$response, r2_inla_report$response),
  ~r2_inla_report[r2_inla_report$response == .x, ]$r2_mvp_cond95hpdci
)
```

Using a hierarchical model to estimate conjointly the temporal trends of  
foodweb strucure at each site, we found weak evidence of a global decrease in
community biomass (CI80%:`r gbm` by decade; median [Credible Interval]) but of a
global increase in species richness (CI80%: `r gr` by decade) across the `r nb_st` sites. 
We did not find evidence of a global trends in connectance and average trophic
level (CI80%: `r gct` and `r gt` respectively). The hierarchical model captured
well the variance associated to the spatial structure of the data with
conditional $R^2$ going from  `r r2ic$log_bm_std` (mean [CI95%]) for community
biomass to `r r2ic$log_rich_std` for species richness (Table SXX).


```{r}
sem_cap <- "(a) Structural equation models linking the temporal trends of the food-web
structure. The path widths are proportional to the standardized slope coefficients. The standardized slope coefficients and their associated 95%
  confidence intervals are displayed along the path. (b to f) Direct bivariate
relationships derived from the structural equation model. The distribution of the
site temporal trends are displayed in Fig. SXX."
```

```{r sem, fig.cap = sem_cap}
knitr::include_graphics(here::here("figures", "fig2.png"))
```

```{r}
tar_load(semeff_tot)
semeff_tot <- semeff_tot %>%
  mutate(across(c(response, predictor), ~str_remove(.x, "mean_")))

rdtps <- map(
  setNames(
    c("ct_ff", "w_trph_lvl_avg", "log_bm_std"),
    c("ct", "tlvl", "bm")
    ),
  ~ list(
    bm = get_semeff_ci(resp = .x, term = "log_bm_std"),
    r = get_semeff_ci(resp = .x, term = "log_rich_std")
    )
)
rdsp <- map(
  setNames(
    c("ct_ff", "w_trph_lvl_avg", "log_bm_std"),
    c("ct", "tlvl", "bm")
    ),
  ~ list(
    bm = get_semeff_ci(resp = .x, term = "log_bm_std", model = "spatial"),
    r = get_semeff_ci(resp = .x, term = "log_rich_std", model = "spatial")
    )
)
```

```{r}
ridtps <- map(
  setNames(
    c("ct_ff", "w_trph_lvl_avg", "log_bm_std"),
    c("ct", "tlvl", "bm")
    ),
  ~ list(
    r = get_semeff_ci(resp = .x, term = "log_rich_std", type = "indirect")
    )
)
ridsp <- map(
  setNames(
    c("ct_ff", "w_trph_lvl_avg", "log_bm_std"),
    c("ct", "tlvl", "bm")
    ),
  ~ list(
    r = get_semeff_ci(resp = .x, term = "log_rich_std",
      model = "spatial", type = "indirect")
    )
)
rttps <- map(
  setNames(
    c("ct_ff", "w_trph_lvl_avg", "log_bm_std"),
    c("ct", "tlvl", "bm")
    ),
  ~ list(
    bm = get_semeff_ci(resp = .x, term = "log_bm_std", type = "total"),
    r = get_semeff_ci(resp = .x, term = "log_rich_std", type = "total")
    )
)
rtsp <- map(
  setNames(
    c("ct_ff", "w_trph_lvl_avg", "log_bm_std"),
    c("ct", "tlvl", "bm")
    ),
  ~ list(
    bm = get_semeff_ci(resp = .x, term = "log_bm_std",
      model = "spatial", type = "total"),
    r = get_semeff_ci(resp = .x, term = "log_rich_std",
      model = "spatial", type = "total")
    )
)
```


Using structural equation models to disentangle the direct and indirect
relationships among foodweb structure descriptors, we found a strong positive
relationship between the temporal trends of community biomass and of
species richness ($r_\delta = `r rdtps$bm$r`$, Fig. \@ref(fig:sem) a and b,
$r_\delta$: standardized slope coefficients, [95% CI]), meaning that both
temporal trends had the same direction in average. At the sites where species
richness decreased over time, community biomass also decreased over time. On the
other hand, at the sites where species richness increased over time, community
biomass also increased over time. 


The temporal trends of connectance were positively linked with the ones of
community biomass ($r_\delta = `r rdtps$ct$bm`$), also meaning that both
temporal trends had the same direction in average. That is, the sites where
food-web connectance decreased over time also had community biomass that
decreased over time and reversely. It suggests that communities that decreased
in biomass over time lose highly connected trophic species over time, and
reversely that communities gaining biomass over time also gain highly connected
trophic species over time. We found a negative relationship between the temporal
trends of connectance and the ones of species richness
($r_\delta = `r rdtps$ct$r`$, Fig. \@ref(fig:sem)d). We further found the
species richness had an indirect positive effect on connectance, through
community biomass ($r_\delta = `r ridtps$ct$r`$). It resulted in a relatively
weak total negative effect of species richness on connectance
($r_\delta = `r rttps$ct$r`$).

The temporal trends of average trophic level had a strong positive relationship
with the ones of community biomass ($r_\delta = `r rdtps$tlvl$bm`$, Fig.
\@ref(fig:sem)e), meaning that sites where
community biomass decreased over time, average trophic level decreased over time
and reversely. It means that in communities losing biomass over time, the
average biomass of the food-web moved down to lower trophic level and vice
versa. However, we found that the temporal trends of average trophic level had
no direct relationship the ones of species richness ($r_\delta = `r rdtps$tlvl$r`$,
Fig. \@ref(fig:sem)f). It suggests that in communities either
losing or gaining species richness over time, the location of average biomass
along trophic level does not significantly change according to species richness.
However, the temporal trends of species richness had an indirect positive
relationship with the temporal trends of average trophic level through community
biomass ($r_\delta = `r ridtps$tlvl$r`$), resulting in a total positive
relationship ($r_\delta = `r rttps$tlvl$r`$).

```{r}
std_cap <- paste0(
  "Assessment of the space-for-time hypothesis. Standardized coefficients
  ($r_\\delta$) derived from the spatial and temporal Structural Equation
  Models. The left, middle and right panels display respectively the direct,
  indirect and total effects of community biomass and species richness on the
  Average trophic level (top panel), the connectance (middle panel) and the
  community biomass (bottom panel) The lines display the confidence intervals at
  95%.")
```

```{r std, fig.cap=std_cap, fig.width=7, fig.asp = .7}
knitr::include_graphics(here::here("figures", "p_sem_tps_sp.pdf"))
```

As for the temporal analysis, we found a positive relationship between
median community biomass and median species richness along the spatial gradient,
but half the strength as the temporal one ($r_\delta = `r rdsp$bm$r`$, Fig.
\@ref(fig:std)). We further found a positive relationship between median
connectance and median community biomass ($r_\delta = `r rdsp$ct$bm`$), as in
temporal trends analysis. However, we found a negative relationship between
median connectance and median species richness, but
three times stronger than in the temporal analysis ($r_\delta = `r rdsp$ct$r`$,
Fig. \@ref(fig:std)). We also found a positive indirect effect of median
richness on median connectance through median community biomass but a weak one
($r_\delta = `r ridsp$ct$r`$), resulting in a strong negative total effect of
median richness on median connectance ($r_\delta = `r rtsp$ct$r`$).

We found a positive relationship between median average trophic level and median
community biomass, but half the strength as in the temporal analysis ($r_\delta
= `r rdsp$tlvl$bm`$, Fig. \@ref(fig:std)). However, we found a strong negative
relationship between median average trophic level and median richness ($r_\delta
= `r rdsp$tlvl$r`$), in contrast with findings in temporal analysis. We also
found a positive indirect relationship between average trophic level and  median
richness through median community biomass (`r ridsp$tlvl$r`), resulting in a
strong total negative effect of median richness on median average trophic level
(`r rtsp$tlvl$r`).

# Discussion

Most temporal trends of for species richness and community biomasss were
classified as stable. Roughly the same number of stations displayed temporal
decrease and increase for species richness, and twice more stations displayed
decrease in community biomass than increase. This result is in accordance with
previous meta analysis on species richness trends of vertebrate in marine,
freshwater and terrestrial systems, which show no change in species richness in
average [@dornelas_assemblage_2014; @blowes_geography_2019] but an increase in
total abundance [@van_klink_meta-analysis_2020].

## Species richness and community biomass are positively linked in space and time

Spatially and temporally, species richness scaled positively with community
biomass. Spatially, this result is in accordance with previous studies in stream
communities [@woods_testing_2020; @danet_species_nodate] but also in grasslands,
salt marches and forests [@hector_plant_1999; @tilman_biodiversity_2014;
@wu_relationship_2015; @li_relationship_2018; but see @grace_integrative_2016].
Therefore, our results confirm that Biodiversity-Ecosystem functioning
prediction also hold in the temporal dynamics of food-webs. The positive
relationship between species richness and total biomass might be due to positive
complementarity in resource use [@carey_determining_2011], which is held by
niche differentiation [@loreau_biodiversity_1998; @loreau_partitioning_2001] or
to the higher probability of getting high biomass species with higher species
richness [@loreau_biodiversity_2001].

## Food-web structure changes according to the temporal trends of community biomass and species richness 

While we found a strong relationship between the temporal trends of community
biomass and the one of species richness, our results suggest that temporal
trends in community biomass and species richness are associated with very
different temporal trends on the connectance and average trophic level. Indeed,
temporal trends of connectance and average trophic level were positively
associated to the temporal trends of community biomass while we found
that species richness temporal trends was negatively and no
significantly related to connectance and average trophic level respectively. All
together, it suggests that temporal trends of community biomass and species
richness are related to different assembly and disassembly processes in
food-webs. 

The temporal trends of connectance were positively linked to that of community
biomass, meaning that when connectance increased through time when community
biomass increased through time in a given site. Reversely, connectance decreased
in food-webs when community biomass decreased through time. Indeed, food-webs
have a highly nested structure, in a way that feeding trophic links of species
at lower trophic level are a subset of the ones of species found at higher
trophic level [@kondoh_food_2010; @nordstrom_nestedness_2015]. It is because
feeding interactions are largely driven by body size, consumers being larger
than their preys [@brose_allometric_2006; @woodward_body_2005]. We also found
that community biomass losses through time were associated to a temporal
decrease of average trophic level and that community biomass temporal gains were
associated to temporal increase of average trophic level. Together with
connectance, it suggests that community biomass losses and gains are associated
to losses and gains in large bodied piscivores, i.e. biomass at the higher
trophic level. In the same line, we found that the temporal trends of community
biomass were positively associated to the temporal trends of both number and
proportion of piscivorous fish species present in the communities (Fig.
SXX). The close association between the temporal trends of community biomass
from one side, and connectance, average trophic level from the other side,
strongly suggest that temporal trends in community biomass in natural freshwater
fish communities are mainly associated to variations in the biomass of the top
trophic level.

In contrast, we found that temporal trends of connectance was weakly negatively
related to the temporal trends of species richness, in contrasts with the strong
negative relationships that we found in the present study and from previous
results over spatial gradient [@dunne_network_2006; @danet_species_nodate].
Furthermore, we found that temporal trends of the proportion of piscivorous
species was negatively associated to the temporal trends of species richness
(Table SXX), in accordance with previous meta-analysis over spatial gradient
[@turney_pyramids_2016] and mesocosm experiment [@downing_ecosystem_2002]. It
resonates with the energetic paradigm of food-webs which proposes that the
presence of species at higher trophic level is constrained by energy loss along
the food chain [@lindeman_trophic-dynamic_1942]. It suggests that the temporal
increase of species richness found in our dataset are associated to a decrease
of connectance because species richness increases are biased toward
non-piscivorous species which have less feeding links than piscivorous species.
We found in the same time that the temporal trends species richness had no
direct link with the temporal trends of the average trophic level, the latter
being weighted by the biomass of each node. An explanation can be that when
species richness increases or decreases through time without community biomass
trends, the associated decrease and respectively increase in proportion of
piscivorous species leads to a redistribution of biomass among remaining
piscivorous species or among the non-piscivorous species.

The temporal trends of species richness had an indirect positive effect on the
temporal trends of both connectance and average trophic level through the
positive relationship between the temporal trends of species richness and
community biomass. The temporal trends of species richness had then an
total effect on the temporal trends of connectance and average trophic level
which was twice lower in magnitude than the magnitude of the total effect of the
temporal trends of community biomass. It suggests that the temporal assembly and
disassembly of food-webs are more sensible to variations in community biomass
than in species richness, in other words that food-web structure is more robust
to species richness change than biomass changes. This result is in line with
evidences that food-web containing generalist predators can rewire in response
to changes in the availability of prey species [@bartley_food_2019]. This result
also resonates with the energy paradigm of food-webs which proposes that
food-webs are primarily constrained by fluxes of matter and energy
[@lindeman_trophic-dynamic_1942], so community biomass and not by species
richness.
 
---
# - Remove the following paragraph:  
# As studies reported community biomass or species richness temporal trends
# [@hallmann_more_2017; @ceballos_biological_2017; @dornelas_assemblage_2014;
# @blowes_geography_2019], we document that temporal trends of species richness
# and community biomass might have different consequences on the structure of the
# community. In particular, the decrease of the average trophic level associated
# to the loss of community biomass could have cascading effect on ecosystem
# functioning as the highest predators are predicted to increase productivity and
# stabilise communities [@wang_biodiversity_2018; @shanafelt_stability_2018;
# @danet_species_nodate]. In contrasts, the loss of species richness might be
# linked to loss of redundancy in the food-web, highlighting that those
# communities may become more at risk regarding future perturbations
# [@yachi_biodiversity_1999]. Interestingly, the hypothesis that temporal trends
# in community biomass is related to higher trophic level in our system has a
# strong reasoning with the effect of human fisheries in marine systems which
# affect primarily fish species at top trophic level [@sprules_surfing_2016].
# Overall, our study highlights that monitoring several facets of biodiversity is
# essential to infer how ecological communities are reshaped by loss and gain of
# biomass and species richness.
---


## Space-for-time substitution does not always hold

In time and space, we found that connectance was positively linked to community
biomass. This result is also in accordance with theoretical work showing that
higher food-web connectance can result in higher community biomass
[@thebault_food-web_2003], or lower [@poisot_trophic_2013], highlighting that
the relation between connectance and community biomass may be dependant on how
food-web structure change with community biomass. Likewise, we found that
average trophic level had a positive relationship with community biomass in
space and time, in accordance with a theoretical study predicting an increase of
community biomass subsequent to the presence of higher predators
[@wang_biodiversity_2018]. Finally, we found a positive relationship between
community biomass and species both in space and time, however the relationship
in time was stronger.

Surprisingly, we found that the temporal trends of connectance were weakly
related to the one of species richness as found spatially in most empirical
food-webs [@dunne_network_2006] and also here. We further found a weak negative
relationship between the temporal trends of average trophic level and the one of
species richness which we found a twice stronger but positive relationship
between median average trophic level and median species richness over the
spatial gradient. An explanation might be that environmental gradient, in
resources in hydrologic contraints might be responsible for the strong negative
effect of species richness on both connectance and average trophic level over
spatial gradient. However, we controlled our spatial analysis by the Biological
Demand in Oxygen, water temperature and the stream gradient. This result is also
in line with other studies which found mismatch between spatial and temporal
patterns [@adler_contrasting_2007; @johnson_testing_2008]. This discrepancy in
space and time might be due to the crucial assumption that variations in space
reflect differences in assembly stages of ecological communities and then
mirrors their temporal assembly/disassembly trajectories. Temporal variation of
species richness might relate on transitory dynamics while spatial gradient
reflect aggregated dynamics over longer time scale including a far number of
processes including high species turnover along spatial gradient.


## Conclusion and perspectives

Our study suggests that species richness and community biomass temporal trends
in natural fish communities relate on different ecological processes, biomass
temporal dynamics being related to variations of food-web structure at the
higher trophic levels while variations of species richness is weakly related to
change in food-web structure. Our result also suggests that space for time
substitution may be relevant to predict the effects of community biomass losses
or gains on food-web structure. However, our findings suggest that
space-for-time substitution might not work for species richness. Our study calls
for further investigations to support the generality of assembly rules in
food-webs. They are crucial to better understand the assembly and disassembly of
food-web and then predict its impact on ecosystem functioning.

# Material & Methods

We used a monitoring of freshwater fishes conducted all over France and
conducted by the Office FranÃ§ais de la BiodiversitÃ© (OFB, previously known as
ONEMA and AFB). The sampling protocols were standardized since 1995 and a
complete description of the sampling process can be found in
@danet_species_nodate (main text and appendixS2). The fishes are sampled using
electrofishing all across the streams in shallow streams and over the bank by
boat in deeper streams. All the fishes are counted and the bodysize of fishes are
recorded for a sample of them, enabling the estimate the distribution of
individual bodysize by species for each sampling [@bonnaffe_comparison_2021;
@danet_species_nodate].

We selected the sites that have been monitored at least 10 years on the
1995-2018 period, with the same sampling protocol over time. We selected
one sampling a year by site. In each site, we ensured low temporal heterogeneity
in sampling period by selecting sampling that were performed in the same period,
leading to a mean standard deviation of sampled month in each site of three
weeks [@danet_species_nodate]. Those steps leads to the selection of 
`r nb_st` sites (Figure \@ref(fig:matmet)A).

## Biomass 

We first inferred the body mass of each fish individual considering an allometric
law, $B_i = 0.01 \times l_i^{3.03}$, $B_i$ being the biomass expressed in gram and $l_i$ the
body length of the individual $i$ expressed in millimetres [@froese_cube_2006]. Then the
biomass of each species and community biomass were obtained by summing the body
mass of individuals. Finally, the biomass was reported to the sampled surface
(in $m^2$) to account for sampling effort.
 
## Food-web inference 

We inferred food-web structure in two steps [@bonnaffe_comparison_2021;
@danet_species_2021]: (1) we first computed the metaweb, describing the
potential trophic interactions among all size classes species, (2) then we
extracted each yearly snapshot of food-webs by extracting species size classes
and their interactions according to their presence in a given sampling event.
 
We inferred the metaweb according to ontogenic diet data and body size
[@gravel_inferring_2013; @poisot_structure_2016; @brose_predator_2019;
@bonnaffe_comparison_2021; @danet_species_2021]. The method is extensively
described in @bonnaffe_comparison_2021 and @danet_species_2021. The food diet of
stream fishes changes along their life cycle or stage, therefore according to
their body size. Each fish species was divided in nine size classes, named
"trophic species", equally distributed in their observed body size range. Thus,
a trophic species is a group of individuals of the same species and size class
that are expected to share the same preys and predators because trophic
interactions are largely determined by predator-prey size ratio
[@brose_allometric_2006]. We also added seven nodes present in the ontogenic
food diet database: detritus, biofilm, phytoplankton, zooplankton, macrophages,
phytobenthos and zoobenthos.  The resulting metaweb contained 45 fish species
divided into nine size classes plus 7 resource nodes, summing up to 412 nodes.
Consideration of size classes, i.e.  trophic species instead of species,
improves inference of trophic interactions [@jennings_weak_2001].

We determined the feeding interactions of trophic species according to their
species identity and their body size. The diet database described two or three
life stages by fish species, each one being delimited by body size
[@bonnaffe_comparison_2021; @danet_species_nodate]. The ontogenic fish diet
database was filled according to fishbase (Froese et al. 2021) and literature
[@bonnaffe_comparison_2021; @danet_species_nodate].

The feeding interactions among fishes were based on the body size ratio
between predators and preys. We defined the predation window of a
piscivorous trophic species as 3% to 45% of its midpoint
[@mittelbach_ontogeny_1998; @claessen_impact_2002; @hart_handbook_2008].  A
trophic link was defined between the piscivorous trophic species and all the
trophic species whose midpoint in body size range was included in the predation
window.  The fish-resource trophic links were set between the trophic species
and the resources nodes according to the food items of their size class.
Finally, the feeding interactions between resources were defined according to the
literature [@allan_stream_2007; @hart_handbook_2008].

## Community and food-web structure

At each site, yearly food-webs were described by their community biomass,
species richness and the evenness of biomass across species. The evenness was
quantified with the Pielou index, computed as the Shannon diversity index
divided by the number of species ($P = \frac{H'}{N}$, with $H'$ being the
Shannon diversity index and $N$ the number of species). Yearly food-web
structure was described by their connectance, describing the degree of
generalism in a network [@dunne_network_2006; @delmas_analysing_2019]. It was
computed as the ratio between the number of actual links and the number of
potential links ($C = \frac{L}{S(S-1)}$, with $L$ being the number of links and
$S$ the number of trophic species). We also computed the average trophic level,
weighted by the biomass of the trophic species. The trophic level of a trophic
species was computed recursively as 1 added to the mean trophic level of the
preys that it consumes [@herendeen_ecological_2008].


## Temporal trends of food-web

We modeled the temporal trends of food-web structure at each site ($Y_i$) using 
linear hierarchical model. Time was considered as the number of year since the
first sampling ($t = 0$) at each site. We accounted for the spatial structure of
the data by adding random intercepts ($a$) and slopes ($b$) for the
basin ($a_n$, $b_n$) and site ($a_{i|n}$, $b_{i|n}$) identity, site effects
being nested in the basin one. 

$$
\begin{aligned}
    Y_{i|n, t} &= \alpha + \betaTime_t + \epsilon_{i|n, t}
  (\#eq:gen)
\end{aligned}
$$ 

- $\alpha = \alpha_0 + a_n + a_{i|n}$
- $\beta = \mu + b_n + b_{i|n}$
- $a_n, a_{i|n}, b_n, b_{i|n}, \epsilon_{i|n, t} \sim \mathcal{N}(0,\,\sigma^{2})$
- $n$: basin, $i$: site $i$, $t$: time $t$

The model parameters were estimated using INLA (Integrated Nested Laplacian
Approximation) bayesian inference with default uninformative priors
[@rue_bayesian_2017]. The prior distributions for the fixed intercept and slope were
modelled as a flat normal distribution with a mean of zero ($\mathcal{N}(0,\, 1000)$).
Prior distributions for the gaussian error $\epsilon_{i|n, t}$ and the random
effects were modelled as a log gamma distribution with
shape and inverse scale parameters ($\mathcal{G}(s, \, \tau) = \mathcal{G}(1, \,
5.10^-5)$), then their respective standard deviation were obtained by
backtransforming the inverse scale parameter ($\sigma = 1 / \sqrt{\tau}$).
Community biomass and species richness were logged transformed.  

The performance of the model was assessed visually by plotting the fitted versus
the observed values (Fig. SXX). We also visually inspected the Posterior
Integral Transform (PIT) and Conditional Predictive Ordinate (CPO) to assess
the quality of the model fit. We also computed the marginal ($R^2_m$)and
conditional ($R^2_c$) R-squared of the models following previous formulations
[@nakagawa_general_2013; @lahuis_explained_2014]. In order to account for the
variability associated with the priors [@gelman_r-squared_2019], we computed the variance of the
posterior distribution  of each predicted
values ($Var_{fit} = \sigma^2(\hat{Y_i})$). We computed $R^2$ values for each predicted
values, then obtaining a $R^2$ distribution [@gelman_r-squared_2019]. We reported mean marginal and
conditional $R^2$ associated the 95% credible interval computed using the
Highest Posterior Density method.

$$
R^2_m = \dfrac{Var_{fit}}{Var_{fit} + Var_{res}} = \dfrac{\sigma^2(\hat{Y_i})}{\sigma^2(\hat{Y_i}) + \sigma^2(Y_i - \hat{Y_i})}
$$

$$
R^2_c = \dfrac{Var_{fit} + (a_n)^2 + (a_{i|n})^2}{Var_{fit}  + (a_n)^2 + (a_{i|n})^2 + Var_{res}}
$$

$y_i$ and $\hat{y_i}$ being respectively the observations and the
predicted values, $Var_{fit}$ and $Var_{res}$ being respectively the variance of
predictive means and the variance of the residuals. $a_n$ and $a_{i|n}$ are
respectively the standard deviation on the random intercept associated to the
basin and the site.

The temporal trends at each site have been extracted from the hierarchical model
using mean BLUP values (Best Linear Unbiaised Predictor), then multiplied
by 10 to get temporal trends by decade. For logged transformed biomass and
species richness, we derived percentage change by decade by transforming the
slopes ($\beta\prime = (e^{\beta } - 1) \times 100 \times 10$).

## Spatial

To assess the validity of the space-for-time substitution hypothesis, we
compared the relationships among food-web structure in time to the ones observed
in space. To do so, we selected the same sites that were used
for the temporal analysis. We summarised temporal series of each station by the
median value over time of each facet of food-web structure described above.
 
# Statistical analysis

We modelled the relationships among food-web structure, that is
connectance and average trophic level, and community biomass ($dB$) and species
richness ($dR$) with Structural Equation Models. We modelled a it such as species
richness is related to community biomass and food-web structure. In
turn community biomass was related to food-web structure. We computed one
structural equation model to assess the relationships among the temporal trends
and one for the relationships over the spatial gradient. As spatial variation of
food-web structure are partly driven by environmental gradients, so we
controlled relationships among variables by adding two PCA axis
synthesizing respectively (1) stream gradient from upstream to downstream and
(2) enrichment (Fig. \@ref(fig:matmet)). Enrichment was characterized by the
average Biological Oxygen Demand [BOD, @mallin_factors_2006][^2]. We further
added a random effect of the hydrographic basin on the intercept.

In order to control for the uncertainties of the estimated temporal trends, each
temporal trend was weighted by the inverse of the sum of the standard deviation 
of the estimated trends, i.e. estimated slopes for the response and the
explicative variables ($w_j = \dfrac{1}{\sum{e_j}}$, $w_j$ being the
weight, and $s_{e_j}$ the standard deviation on the temporal trends of the
variables).

The coefficients of the Structural Equation Models were computed with
PiecewiseSEM R package [@lefcheck_piecewisesem_2016]. The coefficients were
standardizated and the confidence intervals were computed with semEff R package
[@murphy_semEff_2021]. Confidence intervals were obtained by bootstrapping the
linear models 1000 times and computing adjusted bootstrap percentile interval
(BCa), which are adjusted for asymetric distribution of resampling. The marginal
and conditional $R^2$ associated to the linear model of the SEMs were computed
the Nagelkerke method [@lefcheck_piecewisesem_2016].

All the statistical models displayed low multicollinearity (Variance inflation
factor < 3, Table SXX).  We visually inspected the residuals of the linear
models.

```{r}
fig_mat_cap <- paste0("Using sites of stream fishes in French streams that
  have been monitored at least 10 years, 1) we infered the food-web at each site
and each sampling event based on ontogenic food diet information for each
species and predator-prey body size ratio. 2) We computed the temporal trends
and the median of community biomass, species richness, connectance, average
trophic level and evenness of biomass at each site. 3) We then assessed the
relationships among food-web structure descriptors, (a) in time and (b) across space.")
```

```{r matmet, fig.cap=fig_mat_cap, out.width="80%"}
knitr::include_graphics(get_mypath("figures", "mat_met.pdf"))
```

# References  {-}

<div id="refs"></div>

\newpage





