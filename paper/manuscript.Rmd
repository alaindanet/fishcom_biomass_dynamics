---
title: "Food-web temporal changes according to changes in species
richness and community biomass reveal contrasting assembly processes"
author: Alain Danet, Loubna El Madouri, Maud Mouchet, Elisa Thébault and Colin Fontaine (ordre non fixé)
date: \today 
output:
  bookdown::pdf_document2:
    fig_caption: true 
    keep_tex: true
    toc: true
  bookdown::word_document2:
fontsize: 12pt
header-includes:
   - \usepackage{natbib}
   - \usepackage{float}
   - \usepackage[table]{xcolor}
   - \usepackage{multirow}
   - \usepackage{booktabs}
   - \usepackage{makecell}
   - \usepackage{setspace}
   - \doublespacing
   - \usepackage{lineno}
   - \linenumbers
geometry: margin=2cm
bibliography: references.bib
number_sections: true
---

```{r, echo = FALSE}
knitr::opts_chunk$set(
  cache = FALSE,
  collapse = TRUE,
  comment = "#>",
  #fig.dim = c(7, 7),
  fig.fullwidth = TRUE,
  fig.show = "hold",
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  results = TRUE
)
```


```{r, results = FALSE}
library(drake)
library(tidyverse)
library(magrittr)
library(cowplot)
library(viridis)
library(kableExtra)
library(sf)
mypath <- rprojroot::find_package_root_file
source(mypath("R/variable_shortcut.R")) # Define your custom code as a bunch of functions.
source(mypath("R/misc.R"))
source_dir(get_mypath("R")) # Define your custom code as a bunch of functions.

mytheme <- theme_cowplot() +
background_grid()

theme_set(mytheme)
options(knitr.table.format = "latex")
```

```{r}
net_var_bm <- c("log_rich_std", "ct_ff", "w_trph_lvl_avg", "piel_bm",
      "piel_nind")
net_var_rich <- c("log_bm_std", "ct_ff", "w_trph_lvl_avg", "piel_bm",
      "piel_nind")
```

# Introduction

## Trends of biodiversity need to be assessed at multiple facets 

Multiple studies reported dramatic declines of population and community biomass
[@ceballos_biological_2017; @hallmann_more_2017; @albano_native_2021], as well
as decrease in species richness [@barnosky_has_2011; @newbold_global_2015] and
turnover in species composition [@comte_climate_2021]. The documentation of
biodiversity temporal trends, is crucial to evaluate the effect of
global changes [but see @cardinale_is_2018]. Unfortunately, studies often
report trends of one dimension of biodiversity at a time [@hallmann_more_2017,
etc, but see @]. Because the functioning of ecosystem depends ultimately on
multiple facets of biodiversity, such as species richness, evenness and
functional composition [REF @thibaut_understanding_2013], the monitoring of one
biodiversity trend is not enough to project potential effects on ecosystem
functioning.

## Predictions come mainly from space-for-time substitution 

Another concern is that the links between the different components of community
structure often come from spatial comparison [@dunne_network_2006;
@soininen_relationship_2012; @grace_integrative_2016 @danet_species_nodate]. In
order to use spatial comparison to predict the fate of communities facing
changes in species richness or community biomass, studies often implicitly use
the "space for time substitution" hypothesis. This method began to be widely
used in the early 20th century to infer the temporal succession of vegetation
from space variations [@pickett_space-for-time_1989]. It supposes a homology
between variations in space and in time i.e. that spatial sequences correspond
to temporal sequences.  This method have raised criticisms
[@damgaard_critique_2019], with studies showing analogous patterns in space and
time [@blois_space_2013] or not [@johnson_testing_2008;
@adler_contrasting_2007]. Spatial turnover of species composition, dispersal
limitation, disturbance and stochastic processes have been hypothesised to be
responsible for the failure of space for time substitution
[@adler_contrasting_2007; @blois_space_2013].

## Temporal variation of food-webs is largely unknown

The documentation of biodiversity trends generally neglect species interactions
although they are fundamentals to ecosystem functioning
[@thebault_food-web_2003; oconnor_general_2016]. In food-webs, empirical and
theoretical studies reported generally that trophic level positively scales to
community biomass [@wang_biodiversity_2018; @danet_species_nodate] (add
mechanisms ?). Trophic level has also been shown to stabilise the temporal
variation of community biomass [@shanafelt_stability_2018;
@danet_species_nodate]. Connectance, which measures the degree of generalism in
a network, was shown to increase robustness to extinction [@dunne_network_2002].
However, the temporal variation of food-web structure is largely unknown
[@kortsch_disentangling_2021]. Food-web temporal variation are often reported
across small time-steps [@warren_spatial_1989; @pecuchet_novel_2020;
@kaartinen_high_2012].

We know very little how food-web structure vary across time and particularly how
those variations are linked to the variations of other aspects of community
structure such as species richness and community biomass. Spatially, connectance
has been shown to be negatively related to species richness in empirical
food-webs [reviewed in @dunne_network_2006]. Connectance has been shown to scale
positively or negatively with community biomass in theoretical models
[@thebault_food-web_2003; @poisot_trophic_2013] (*Add mechanism?*). In order to
improve our understanding on the assembly mechanisms in food-webs, it is thus
crucial to assess how biomass and species richness variation are associated to
variations in food-web structure. 

In this line, how the temporal changes of community biomass are related to
temporal changes of species richness can still be question in natural settings,
especially in food-webs. Our knowledge on how the temporal changes of food-web
structure are related  to temporal changes in community biomass and species
richness is almost zero. Our knowledge on the relationships between food-web
structure comes often from comparison of food-web snapshots along spatial
gradient, raising the question of the validity of space for time substitution to
infer consequences of species richness and community biomass on food-web
structure. The increasing amount of availability ecological temporal series
makes possible to assess those questions. Using a standardized monitoring of
fish freshwater communities on the period 1995-2018 and a method of food-web
inference based on allometric relationships and food diet data, we assessed the
relationships among temporal changes of food-web structure, trends of community
biomass and trends in species richness. We then assessed the validity of space
for time substitution by comparing if temporal relationships display the same
patterns as spatial gradient.

---
## Variations of community biomass and species richness are predicted to affect community structure
#Changes of species richness and community biomass are indeed
#predicted to affect community structure. The positive link between biodiversity
#and ecosystem functioning in experimental studies predict that loss and
#gain of species richness should respectively result in loss and gain of
#community biomass [@tilman_biodiversity_2014; @pennekamp_biodiversity_2018]. But
#this relation is not always found in natural settings [@grace_integrative_2016;
#@li_relationship_2018; @maureaud_biodiversityecosystem_2019].
#
#Variations of species richness can also result in variation of evenness, i.e.
#equitability of species abundances or biomasses. Meta-analysis reported that
#higher evenness of abundances is linked to higher plant biomass in grasslands
#and primary productivity in marine ecosystems [@soininen_relationship_2012].
#Furthermore, studies reported that higher evenness plays a role of insurance in
#face of perturbations [@wittebolle_initial_2009]. Indeed, most studies reported
#positive relationship between species richness and evenness, but also neutral
#and negative ones [@soininen_relationship_2012; @ma_species_2005;
#@maureaud_biodiversityecosystem_2019].
## Variations of community biomass and species richness are predicted to affect food-web structure
---


# Methods

## Data

## Data selection

We selected the stations that have been monitored at least 10 times on the
1995-2018 period. 

## Biomass 

We first inferred the body mass of each fish individual thanks to an allometric
law, $B_i = 0.01 \times l_i^3.03$, $B_i$ being biomass in gram and $l_i$ the
body length in millimetre of the individual $i$ [@froese_cube_2006]. Then the
biomass of each species and community biomass were obtained by summing the body
mass of individuals. Finally, the biomass was reported to the sampled surface
(in $m^2$) to account for sampling effort.
 
## Food-web inference 

We inferred food-web structure in two steps [@bonnaffe_comparison_2021;
@danet_species_nodate]: (1) we first computed the metaweb, describing the
potential trophic interactions between all species size classes, (2) then we
extracted each local time snapshot of food-webs by extracting species size
classes and their interactions according their presence in a given sampling
event.
 
We inferred food-web structure according to ontogenic diet data and body size
[@gravel_inferring_2013; @poisot_structure_2016; @brose_predator_2019;
@bonnaffe_comparison_2021; @danet_species_nodate]. The method is extensively
described in @bonnaffe_comparison_2021 and @danet_species_nodate. The food diet
of stream fishes, as many organisms, change along their life and therefore
according to their body size. Each fish species was divided in nine size
classes, named trophic species, equally distributed in their observed body size
range.  A trophic species is a group of individuals of the same species and size
class that are expected to share the same preys and predators. We also added
seven nodes present in the ontogenic food diet database: detritus, biofilm,
phytoplankton, zooplankton, macrophages, phytobenthos and zoobenthos.  The
resulting metaweb contained 45 fish species divided into nine size classes plus
7 resource nodes, summing up to 412 nodes.  Consideration of size classes, i.e.
trophic species instead of species, improves inference of trophic interactions
[@jennings_weak_2001].

We determined the feeding interactions of trophic species according to their
species identity and their body size. The diet database described two or
three life stages by fish species, each one being delimited by body size
[@bonnaffe_comparison_2021; @danet_species_nodate]. The life stage of a fish
trophic species was determined by the centre of its body size range, hereafter
midpoint. The ontogenic fish diet database was filled according to fishbase
(Froese et al. 2021) and literature [@bonnaffe_comparison_2021;
@danet_species_nodate].

The feeding interactions between fishes were based on the body size ratio
between predators and preys. As this, we defined the predation window of a
piscivorous trophic species as 3% to 45% of its midpoint
[@mittelbach_ontogeny_1998; @claessen_impact_2002; @hart_handbook_2008].  A
trophic link was defined between the piscivorous trophic species and all the
trophic species whose midpoint in body size range was included in the predation
window.  The fish-resource trophic links were set between the trophic species
and the resources nodes according to the food items of their size class.
Finally, the feed interactions between resources were defined according to the
literature [@allan_stream_2007; @hart_handbook_2008].

## Food-web and community structure

We characterized food-webs by their connectance, describing the degree of
generalism in a network [@dunne_network_2006; @delmas_analysing_2019]. It was 
computed as the ratio between the actual number of links and the number of
potential links ($C = \frac{L}{S(S-1)}$, with $L$ being the number of links and
$S$ the number of trophic species). We also computed the average trophic level,
weighted by the biomass of the trophic species. The trophic level of a trophic
species was computed recursively as 1 added to the mean trophic level of the
preys that it consumes.

We described community structure by its community biomass, species richness and
the evenness of the number of individual and the amount of biomass across
species. The evenness was quantified with the Pielou index, computed as the
Shannon diversity index divided by the number of species ($P = \frac{H'}{N}$,
with $H'$ being the Shannon diversity index and $N$ the number of species).

```{r}
loadd(slope_com_var_no_covar, st_mono_trends_stable_rich_bm)
```
```{r}
nb_st <- unique(slope_com_var_no_covar$station) %>% length
rm(slope_com_var_no_covar)
nb_st_rich_bm <- st_mono_trends_stable_rich_bm %>% length
```

## Classification of temporal trajectories

To characterize the links among the temporal trends of network and community
structure and the temporal trends of community biomass and species richness, we
characterized the temporal trajectories of network and community structure at
each site. We used a method based on second order polynomial which allows to
assess both the direction and the monotony of temporal trends
[@rigal_method_2020]. To avoid the inclusion of many types of biomass and species
richness trends (i.e. accelerating, decelerating, etc...), we selected the
stations that displayed monotonic trends for these variables, i.e. the ones for
which the second order polynomial term was non significant. Over the `r nb_st`
stations, the selection procedure resulted in `r nb_st_rich_bm` for community
biomass and species richness analysis. However, the results were robust to the
inclusion of non monotonic trends (Fig. SXX).

There was a clear relationship between the size of the communities and their
temporal dynamics. Communities that displayed low community biomass at the
beginning of their monitoring tend to display biomass increase through time
and reversely. We observed the same pattern for species richness, with
communities that displayed high species richness at the beginning of their
monitoring tend to display a decrease in species richness through time and
reversely.

## Spatial

In spatial analysis, we selected the same stations that were used for the
temporal analysis. We summarised temporal series of each stations by the median
value over time of each variable.
 
# Statistical analysis

## Temporal trends 

We modelled the dynamics the temporal trends of food-web structure ($dN$)
in function of the temporal trends of community biomass ($dB$) and species
richness ($dR$) in order to test the relationship among the temporal dynamics of network
structure from one side and species richness and community biomass from another
side.

$dN = \alpha + \beta_1dB + \beta_2dR + \epsilon$

With:

  - $dN$: temporal trend of network structure and communities structure
  - $dB$: temporal trend of community (log) biomass
  - $dR$: temporal trend of (log) species richness

In order to control for the uncertainties of the estimated temporal trends, each
temporal trend was weighted by the inverse of the product of the standard errors of the
estimated trends, i.e. slopes for the response and the explicative
variables. We also tested a statistical model taking in account the interaction
between the temporal trends of species richness and community biomass (i.e.
adding $\beta_3dBdR$), the results are presented in supplementary material (Fig.
SXX). To model the relationships between the temporal trends of community
biomass and the one of species richness, we built equations as $dB = \alpha +
\beta_1dR + \epsilon$.

  

## Spatial trends

Spatial gradient of food-web structure are partly driven by environmental gradients, so
we controlled relationships among community structure variables by two PCA axis
synthesizing respectively (1) stream size and (2) average temperature and
enrichment. Enrichment was characterized by the average Biological Oxygen
Demand [BOD, @mallin_factors_2006].
 
$N = \alpha + \beta_1B + \beta_2R + \beta_3E_1 + \beta_4E_2 + \epsilon$ 

With:

  - $N$: median network structure and communities structure
  - $B$: median community biomass
  - $R$: median species richness 
  - $E_1$: PCA1 related to stream size
  - $E_2$: PCA2 related to average temperature and average BOD

To model the relationships between community biomass and species richness along
the spatial gradient, we built the equation as $B = \alpha + \beta_1R +
\beta_3E_1 + \beta_4E_2 + \epsilon$.

The significativity of the effects were tested with ANOVA. In order to compare
the magnitude of the effects of community biomass and species richness in both
temporal and spatial models, we computed standardized slopes ($r_{\delta}$) and
their associated standard errors.

$r_{\delta} = \beta\frac{s_x}{s_y}$

With $\beta$ being the unstandardised slope, $s_x$ and $s_y$ the standard
deviation of the explicative and response variable.

All the statistical models displayed low multicollinearity (VIF < 3, Table XX).
We visually inspected the residuals of the linear models (TODO).

# Results

```{r}
loadd(rsq_sp_mod, summary_table, sp_models, model_summary)

loadd(rsq_table_bm_rich_mono_stable_trends, sp_rsq_table_bm_rich_mono_stable_trends)

loadd(rigal_classification)
```

```{r}
class_trends_bm_rich <- rigal_classification %>%
  filter(variable %in% c("log_bm_std", "log_rich_std")) %>%
  unnest(classif) %>%
  select(variable, station, direction, acceleration, shape_class)

res_trends <- class_trends_bm_rich %>%
  filter(acceleration == "constant") %>%
  group_by(variable, direction) %>%
  summarise(n = n()) %>%
  group_by(variable) %>%
  mutate(total = sum(n), percent = round(n / sum(n) * 100))

x_var <- c("log_bm_std", "log_rich_std")
stable_st_var <- map(x_var,
  ~class_trends_bm_rich[
    class_trends_bm_rich$variable == .x &
    class_trends_bm_rich$direction == "stable",
      ]$station
)
names(stable_st_var) <- x_var

sum(stable_st_var[["log_bm_std"]] %in% stable_st_var[["log_rich_std"]] == TRUE) / length(stable_st_var[["log_bm_std"]])

sum(stable_st_var[["log_rich_std"]] %in% stable_st_var[["log_bm_std"]] == TRUE) / length(stable_st_var[["log_rich_std"]])
```


```{r}
rsq_piel_nind <- rsq_table_bm_rich_mono_stable_trends %>%
  filter(Response == "piel_nind") %>%
  .$R.squared %>%
  round(., 3)

rsq_tlvl <- rsq_table_bm_rich_mono_stable_trends %>%
  filter(Response == "w_trph_lvl_avg") %>%
  .$R.squared %>%
  round(., 3)

rsq_tlvl_sp <- sp_rsq_table_bm_rich_mono_stable_trends %>%
  filter(Response == "w_trph_lvl_avg") %>%
  .$Conditional %>%
  round(., 3)

rsq_piel_bm_sp <- sp_rsq_table_bm_rich_mono_stable_trends %>%
  filter(Response == "piel_bm") %>%
  .$Conditional %>%
  round(., 3)
```

Overall, we found high heterogeneity in the explicative power of statistical
models linking temporal dynamics of food-web structure and the one of community
biomass and species richness spanning from $R_{adj}^2= `r rsq_piel_nind`$ for
the evenness of abundances to $R_{adj}^2= `r rsq_tlvl`$ for average trophic
level (Table \@ref(tab:rsq)). The spatial models were more performant, with
$R_{cond}^2$ varing from $`r rsq_tlvl_sp`$ to $`r rsq_piel_bm_sp`$ (Table
\@ref(tab:rsq-sp)). Over the station in the dataset, we found that
`r res_trends[res_trends$variable == "log_bm_std", ]$total[1]` stations displayed monotonic trends for biomass. Among them, 
`r res_trends[res_trends$variable == "log_bm_std" & res_trends$direction == "stable", ]$percent`%
were classified stable,
`r res_trends[res_trends$variable == "log_bm_std" & res_trends$direction == "decrease", ]$percent`%
decreasing,
`r res_trends[res_trends$variable == "log_bm_std" & res_trends$direction == "increase", ]$percent`%
increasing. Regarding the species richness, we found that
`r res_trends[res_trends$variable == "log_rich_std", ]$total[1]` stations displayed monotonic trends.
`r res_trends[res_trends$variable == "log_rich_std" & res_trends$direction == "stable", ]$percent`%
were classified stable,  
`r res_trends[res_trends$variable == "log_rich_std" & res_trends$direction == "decrease", ]$percent`%
as decreasing, and 
`r res_trends[res_trends$variable == "log_rich_std" & res_trends$direction == "increasing", ]$percent`% increasing.

---
#Overall, we found no significant effect of the temporal gain or losses of
#communinity biomass biomass and species richness on the relationship between the
#temporal trends of community structure and that of biomass and species richness
#(Table \@ref(tab:aov)).
---

## Relationships between temporal trends 

```{r}
loadd(std_table_bm_rich_mono_stable_trends)
std <-
  std_table_bm_rich_mono_stable_trends %>%
  mutate(
    type = recode(type, spatial = "sp", temporal = "tps"),
    response = recode(response, log_bm_std = "bm", log_rich_std = "rich", ct_ff
      = "ct", piel_bm = "p_bm", piel_nind = "p_n", w_trph_lvl_avg = "tlvl"),
    term = recode(term, log_bm_std = "bm", log_rich_std = "rich")
    ) %>%
  rename(t = type, rep = response, sest = std_estimate) %>%
  mutate_at(vars(sest, stdse), ~round(.x, 2))
tps_bm <- std %>%
  filter(t == "tps", term == "bm")

tps_bm_sest <- tps_bm$sest
names(tps_bm_sest) <- tps_bm$rep
```

```{r}
tps_r <- std %>%
  filter(t == "tps", term == "rich")

tps_r_sest <- tps_r$sest
names(tps_r_sest) <- tps_r$rep
```

```{r}
sp_b <- std %>%
  filter(t == "sp", term == "bm")
sp_b_sest <- sp_b$sest
names(sp_b_sest) <- sp_b$rep

sp_r <- std %>%
  filter(t == "sp", term == "rich")
sp_r_sest <- sp_r$sest
names(sp_r_sest) <- sp_r$rep
```

We found a strong positive relationship between the temporal trends of community
biomass and the one of species richness ($r_\delta = `r tps_r_sest["p_bm"]`$,
Fig. \@ref(fig:bef), Table \@ref(tab:aov)), meaning that both temporal trends
had the same direction in average. At stations
where species richness decreased over time, community biomass also decreased
over time. On the other hand, at stations where species richness increased over
time, community biomass also increased over time. In spatial analysis, we also
found a positive relationship between median community biomass and median
species richness, but twice less strong than the temporal one
($r_\delta = `r sp_b_sest["rich"]`$).

The temporal trends of connectance was positively linked with the one of
community biomass ($r_\delta = `r tps_bm_sest["ct"]`$), meaning also that both
temporal trends had the same direction in average. That is, the stations where
food-web connectance decreased over time had also community biomass that
decreased over time and reversely. It means that communities that lose biomass
over time, also loses generalist predators and reversely that communities
gaining biomass over time also gain generalist predators. Spatially, we found
also a positive relationship between median connectance and median species
richness ($r_\delta = `r sp_b_sest["ct"]`$). However, we did not observe
significant relationships between the temporal trends of connectance and the one
of species richness (Fig. \@ref(fig:bmr)D) when we found spatially a stong
negative relationship between median connectance and median species richness
($r_\delta = `r sp_r_sest["ct"]`$, Fig. \@ref(fig:std)).

We found that the temporal trends of average trophic level had a strong positive
relationship with the one of community biomass 
($r_\delta = `r tps_bm_sest["tlvl"]`$, Fig. \@ref(fig:bmr)B, Table
\@ref(tab:aov)), meaning
that stations where community biomass decreased over time, average trophic level
decreased over time and vice versa. It means that in communities losing biomass
over time, the average biomass of the food-web moved toward lower trophic level
and vice versa. The spatial gradient also showed a positive relationship between
median average trophic level and median community biomass, but twice less strong
than the temporal one ($r_\delta = `r sp_b_sest["tlvl"]`$, Fig. \@ref(fig:std),
Table \@ref(tab:aov-sp)). As for connectance, the temporal trends of average
trophic level was unrelated to the one of species richness. It means in
communities either losing or gaining species richness over time, the location of
average biomass along   trophic level did not significantly change.  However, we
found a strong negative relationship along the spatial gradient 
($r_\delta = `r sp_r_sest["tlvl"]`$, Fig. \@ref(fig:std), Table
\@ref(tab:aov-sp)).

Evenness of species biomass was negatively linked to community
biomass in time and along the spatial gradient 
($r_\delta = `r tps_bm_sest["p_bm"]`$ and $`r sp_b_sest["p_bm"]`$ resp.; Fig.
\@ref(fig:bmr)C, Fig. \@ref(fig:std)). In time, it means that food-webs that
lost biomass over time also had biomass more evenly distributed by species over
time and vice versa. A similar reasoning applies to spatial gradient. On the
other hand, we found a positive relationship between the temporal trends of
biomass evenness and the one of species richness (Fig. \@ref(fig:bmr)F, Table
\@ref(tab:aov), $r_\delta = `r tps_r_sest["p_bm"]`$). We found the same
relationship along the spatial gradient, twice strong however 
($r_\delta = `r sp_r_sest["p_bm"]`$).

# Discussion

## BEF works in space and time

Spatially and temporally, species richness scaled positively with community
biomass. Spatially, this result is in accordance with numerous studies was
already found in streams [@woods_testing_2020; @danet_species_nodate] but also
in grasslands, salt marches and forests [@hector_plant_1999;
@tilman_biodiversity_2014; @wu_relationship_2015; @li_relationship_2018; but see
@grace_integrative_2016]. Therefore, our results confirm that BEF prediction
works also in time in food-webs. The positive relationship between species
richness and total biomass might be due to positive complementarity in resource
use [@carey_determining_2011], which is held by niche differentiation
[@loreau_biodiversity_1998; @loreau_partitioning_2001] or to the higher
probability of getting high biomass species with higher species richness
[@loreau_biodiversity_2001].

## Biomass and species richness temporal trends relies on different assembly rules

While we found a strong relationship between the temporal trends of community
biomass and the one of species richness, our results suggest that temporal trends in
community biomass and species richness have highly different consequences on the
structure of food-webs. Indeed, temporal trends of connectance and average
trophic level was positively associated to the one of community biomass while no
significant association was found with temporal trends of species richness.
Moreover, biomass evenness temporal trends was negatively associated to temporal
trends of community biomass whereas positively associated to temporal trends of
species richness. All together, it suggests that temporal trends of biomass and
species richness indicates different food-webs assembly processes. 

The temporal trends of connectance was positively linked to that one of
community biomass, meaning that connectance increases through time in a given
site when community biomass increases through time and reversely that
connectance decreased in food-webs where community biomass decreased through
time. It suggests that community biomass losses are linked to the generalist
predators while gains in community biomass are associated to the higher presence
of generalist predators. This interpretation is in line with (2) the results
that community biomass losses through time were associated to a temporal
decrease of average trophic level and that community biomass temporal gains were
associated to temporal increase of average trophic level. Another piece of
evidence is that evenness of biomass, measured by the pielou, decreased through
time as community biomass increased, meaning that biomass distribution across
species become less even when community biomass decreased. Reversely, in
food-webs that displayed temporal decrease in community biomass, we found that
evenness of biomass increased, i.e. that biomass distribution across species
become more even. Because predators-preys interactions relates in part on
bodysize and thus bodymass in part, we may expect that a given gain in higher
predators leads to a decrease of biomass evenness and reversely. In the same
line, the temporal trends of community biomass were positively correlated to the
temporal trends of the number and proportion of piscivorous trophic species
present in the community (Fig. SXX).

In contrast, we found temporal trends of connectance and average trophic level
were not related to the temporal trends of species richess. However, we found
that temporal trends of the number of piscivorous species and piscivorous
trophic species were strongly positively linked to the temporal trends of
species richness (Fig. S3). It suggests that the temporal decrease of species
richness that we observed in our data are concomimant to simultaneous losses of
piscivorous and non-piscivorous species that leads to the absence of temporal
trend in connectance and average trophic level and symmetrically for the
temporal increase of species richness. Furthemore, we found that the temporal
trends of biomass evenness had a positive relationship with the one of species
richness, the opposite of what we found for temporal trends of community biomass.
Together with the fact that species richness temporal trends had a positive
relationship with the temporal trends of community biomass, it suggests that the
species richness temporal trends are linked to gain or loss of redundancy in
food-webs without a clear signature in the vertical structure of the food-webs.


## Space for time substitution does not always hold

In time and along spatial gradient, we found that connectance was positively
linked to community biomass. This result is also in accordance with theoretical
work showing that higher food-web connectance can result in higher community
biomass [@thebault_food-web_2003], but other display negative relationship
[@poisot_trophic_2013], highlighting that the relation between connectance and
community biomass may be dependant of assembly processes at work.]. In the same
line, we found that average trophic level had a positive relationship with
community biomass in space and time. It is in accordance with a theoretical
model showing that the presence of higher predators can lead to higher community
biomass [@wang_biodiversity_2018].  We also found in space and time that
evenness of biomass was negatively related to community biomass. This result is
in accordance with the observation of top-heavy shape of biomass pyramids in
food-webs, particularly in freshwater systems [@mccauley_prevalence_2018]. Many
mechanisms can be responsible have been invoked to explain this pattern but
omnivory, which is present in most of piscivorous species in our dataset, may
favor this shape by increasing food transfer efficiency toward higher trophic
level.

Surprisingly, we found that the temporal trends of connectance was not related
to the one of species richness as found spatially in most empirical food-web
[@dunne_network_2006] and also in the present study. We explained this pattern
by the fact that the temporal variation of species richness in our dataset seems
to be linked to variation in the level of redundancy in the role in the
food-webs rather than overall change of the vertical structure of food-webs. The
same rational can applied with average trophic level. *This discrependacy might
be due to the crucial assumptions that variations in space will correspond to
differences of assembly stages and then reflect the assembly/disassembly
trajectories in time of communities. Temporal variation of species richness
might relate on transitory dynamics while spatial gradient reflect aggregated
dynamics over longer time scale including a far number of processes including
high species turnover along spatial gradient.* This result is in line with other
studies which found mismatch between spatial and temporal patterns
[@adler_contrasting_2007; @johnson_testing_2008].  
However, we found agreement between space and time analysis for the positive
relationship between evenness of biomass and species richness. Another reason
might be that the spatial gradient displays a higher range of variation for
species richness than the temporal stations (Fig. S2). However, it might not
explain why we found strong relationships between the temporal trend of species
richness from one side and the temporal trends of community biomass, biomass
evenness, the number of piscivore species (Fig. S3). *No more idea, need
coffee*.
  
However, our result that food-web structure does not change a lot with temporal
variation of species richness is in line with the insurance hypothesis
[@yachi_biodiversity_1999]. In this view, the temporal loss and gain of species
richness represent respectively loss and gain of redundancy in the
food-web structure. Our results have profound implications for conservation. As
more and more studies reported community biomass and species richness trends
[@hallmann_more_2017; @ceballos_biological_2017], we documented that they might
not be equivalent in terms of consequences on the structure of the community. In
particular, the loss of the highest trophic level associated to the loss of
community biomass could have dramatic consequences on ecosystem functioning
as the highest predators are prone to stabilise communities
[@shanafelt_stability_2018; @danet_species_nodate]. In contrasts, the loss of
species richness might be linked to loss of redundancy in the food-web,
highlighting that those communities may become more at risk regarding future
perturbations [@yachi_biodiversity_1999]. Overall, it suggests that monitoring
several facets of biodiversity is essential to infer how ecological communities
are reshaped by loss and gain of biomass and species richness.

We further found that most temporal trends of food-webs were classified as
stable for species richness and community biomass. We found almost the same
number of stations that displayed temporal decrease or increase for species
richness, and twice more stations displayed decrease in community biomass than
increase. While, the spatial coverage of our data is good, it would be rather
risky to conclude about biodiversity trends in freshwater fish communities in
France. Mainly because we did not assess pressures that may affect
the temporal trends such as land-use changes and species invasions
[@comte_climate_2021; @su_human_2021].

---
### Biomass and richness gains and losses are symmetric processes in terms of community structure
#
#We found no case in which gain or losses of biomass and richness lead to
#different relationship between the temporal dynamic of community structure and
#the one of biomass and species richness. We could have imagined that
#extinction/colonisation processes or immigration/extinction debt could have lead
to different relationships.
---

## Conclusion and perspectives

Our study suggests that richness and biomass temporal trends in natural fish
communities relate on different ecological processes, biomass temporal dynamics
being related to variations of at highest trophic levels while species richness
impacts redundancy of food-web structure. Our result also suggests that space
for time substitution may be relevant to predict the effects of community
biomass losses or gains on food-web structure. However, it might not the case
for species richness temporal variation. We look forward to next investigations
to see the generality of assembly rules in food-webs. There are crucial to
better understand the temporal dynamics of food-web structure and then its
impact on ecosystem functioning.

# References  {-}

<div id="refs"></div>

\newpage

# Figures {-}


```{r}
fig_mat_cap <- paste0(
  "(A) Distribution of the fishing sites. (B-F) Temporal trends of biomass,
  species richness, connectance, average trophic level and evenness of biomass
  for two stations. (À retravailler)"
)
```
```{r, fig.cap=fig_mat_cap, out.width="100%"}
knitr::include_graphics(get_mypath("figures", "mat_met_inkscape.pdf"))
```



```{r}
fig_bm_cap <- paste0(
  "Relationship between community structure and community biomass. Left panel
  displays the relationships between the temporal trends of community structure
  and the one of community biomass. Lines correspond to the predictions of the
  linear models while the points are colored according the median community
  biomass of the three first years of the given temporal series. The lines
  surrounding each point represent the standard error associated to the temporal
  trends. Right panel displays the
  spatial relationship between median community structure over time and the
  median community biomass over time."

)

fig_rich_cap <- paste0(
  "Relationship between community structure and species richness. Left panel
  displays the relationships between the temporal trends of community structure
  and the one of species richness. Lines correspond to the predictions of the
  linear models while the points are colored according the median species
  richness of the three first years of the given temporal series. The lines
  surrounding each point represent the standard error associated to the temporal
  trends. Right panel displays the spatial relationship between median community
  structure over time and the median species richness over time."

)
```

```{r}
loadd(sp_fig1_2_bm_rich_mono_stable_trends,
  pred_bm_rich_mono_stable_trends)

fig1_2 <- get_plot_rich_bm(
  predict_plot = pred_bm_rich_mono_stable_trends,
  get_list = TRUE,
  rm_legend = FALSE,
  bm_x = "log_bm_std",
  bm_y = c("ct_ff", "w_trph_lvl_avg", "piel_bm"), #, "piel_nind"
  rich_y = c("ct_ff", "w_trph_lvl_avg", "log_bm_std", "piel_bm"), #, "piel_nind"
  rich_x = "log_rich_std"
  )
p_bm <- fig1_2$bm
names(p_bm) <- c("ct_ff", "w_trph_lvl_avg", "piel_bm")
#plot_grid(plotlist = p_bm)

p_sp_bm <- sp_fig1_2_bm_rich_mono_stable_trends$bm
names(p_sp_bm) <- c("log_rich_std", "ct_ff", "w_trph_lvl_avg",
  "piel_bm", "piel_nind")
```

```{r}
fig_bef_cap <- paste0(
  "Relationship between the temporal trends of community structure
  and the one of species richness. Lines correspond to the predictions of the
  linear models. The lines surrounding each point represent the standard error
  associated to the temporal trends."
)
```
```{r bef, fig.cap=fig_bef_cap}
ggMarginal(fig1_2$rich$log_bm_std, type = "histogram")
```

```{r}
fig_bm_rich_cap <- paste0(
  "Relationship among the temporal trends of community structure
  and the one of species richness and community biomass. The lines
  surrounding each point represent the standard error associated to the temporal
  trends."
)
```
```{r bmr, out.width = "100%", fig.cap=fig_bm_rich_cap}
library(ggExtra)
fig2 <- fig1_2
fig2$rich$log_bm_std <- NULL
fig2$rich <- map(fig2$rich,
  ~ .x +
    theme(axis.text = element_text(size = 6),
    axis.title = element_text(size = 8))
  )
fig2$bm <- map(fig2$bm,
  ~ .x + theme(
    axis.text = element_text(size = 6),
    axis.title = element_text(size = 8)
    )
)


# Add histograms
fig2$bm <- map(fig2$bm,~ggMarginal(.x, type = "histogram"))
fig2$rich <- map(fig2$rich,~ggMarginal(.x, type = "histogram"))

plot_grid(
  plot_grid(plotlist = fig2$bm, nrow = 1, labels = c("A", "B", "C")),
  plot_grid(plotlist = fig2$rich, nrow = 1, labels = c("D", "E", "F")),
  nrow = 2
)
```


```{r bm, eval=FALSE, fig.height = 12, fig.cap=fig_bm_cap}
ti <- list()
for (
  i in c("log_rich_std", "w_trph_lvl_avg", "piel_bm", "piel_nind", "ct_ff")
  ) {
  ti[[i]] <- list(p_bm[[i]], p_sp_bm[[i]])
}


# Make the label on two lines
fig1 <- plot_grid(plotlist = c(ti[[1]], ti[[2]], ti[[3]], ti[[4]], ti[[5]]), ncol = 2)
fig1
```

```{r}
p_rich <- fig1_2$rich
p_sp_rich <- sp_fig1_2_bm_rich_mono_stable_trends$rich
```

```{r rich, eval=FALSE,fig.height = 12, fig.cap=fig_rich_cap}
trich <- list()
for (i in c("log_bm_std", "w_trph_lvl_avg",  "piel_bm", "piel_nind", "ct_ff")) {
  trich[[i]] <- list(p_rich[[i]], p_sp_rich[[i]])
}

# Make the label on two lines
fig2 <- plot_grid(
  plotlist = c(trich[[1]], trich[[2]], trich[[3]], trich[[4]], trich[[5]]),
  ncol = 2)
fig2
```

```{r}
std_cap <- paste0(
  "Standardized coefficients of the effects of community biomass and species
  richness on food-web structure for the temporal and spatial models. The lines
  display the standard errors."
)
```

```{r std, fig.cap=std_cap}
loadd(fig_std_coef)
fig_std_coef
```


\newpage

# Tables {-}

## Statistical models 

### Temporal

```{r}
loadd(pred_bm_rich_mono_stable_trends,
  model_bm_rich_int_mono_stable_trends,
  model_bm_rich_int_mono_stable_trends,
  anova_table_bm_rich_mono_stable_trends)

anova_table_bm_rich_mono_stable_trends %>%
  mutate(
    response = str_replace_all(response, var_replacement()),
    term = str_replace_all(term, var_replacement())
  ) %>%
  kable(.,
    booktabs = TRUE,
    row.names = FALSE,
    caption =
      paste0(
      "ANOVA results for the links between the temporal trends of
      community biomass and the temporal trends of the network structure."
    ),
  label = "aov"
  ) %>%
  kable_styling(latex_options = c("scale_down", "stripped")) %>%
  collapse_rows(columns = 1, valign = "top")
```

```{r}
loadd(reg_table_bm_rich_mono_stable_trends)
reg_table_bm_rich_mono_stable_trends %>%
  mutate(
    response = str_replace_all(response, var_replacement()),
    term = str_replace_all(term, var_replacement())
    ) %>%
kable(., booktabs = TRUE,
  row.names = FALSE,
  caption =
    paste0(
      "Regression coefficients for the linear models explaining the links
      between the temporal trends of community biomass and the temporal trends
      of the network structure."),
      label = "reg"
      ) %>%
  kable_styling(latex_options = c("scale_down", "striped")) %>%
  collapse_rows(columns = 1, valign = "top")
```



```{r}
loadd(rsq_table_bm_rich_mono_stable_trends)
rsq_table_bm_rich_mono_stable_trends %>%
  mutate(
    Response = str_replace_all(Response, var_replacement())
  ) %>%
  kable(., booktabs = TRUE,
    caption =
      paste0(
      "Marginal and conditional squared R for temporal models."),
  label = "rsq"
      ) %>% #
  kable_styling(latex_options = c("striped")) %>%
  collapse_rows(columns = 1, valign = "top")
```


### Spatial

```{r}
loadd(
  sp_anova_table_bm_rich_mono_stable_trends,
  sp_rsq_table_bm_rich_mono_stable_trends
)
```


```{r}
sp_anova_table_bm_rich_mono_stable_trends %>%
  mutate(
    response = str_replace_all(response, var_replacement()),
    term = str_replace_all(term, var_replacement()),
  ) %>%
  kable(.,
    booktabs = TRUE,
    row.names = FALSE,
    caption =
      paste0(
      "ANOVA results for the links among the spatial variation of community
      biomass and species richness and the one of network structure."),
  label = "aov-sp"
  ) %>%
  kable_styling(latex_options = c("scale_down", "striped")) %>%
  collapse_rows(columns = 1, valign = "top")
```

```{r}
sp_rsq_table_bm_rich_mono_stable_trends %>%
  mutate(
    Response = str_replace_all(Response, var_replacement())
  ) %>%
  kable(., booktabs = TRUE,
    caption =
      paste0(
      "Marginal and conditional squared R for spatial models."),
  label = "rsq-sp"
      ) %>% #
  kable_styling(latex_options = c("striped")) %>%
  collapse_rows(columns = 1, valign = "top")
```

