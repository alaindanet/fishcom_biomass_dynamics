---
title: "Community biomass and species richness temporal trends reveal contrasting assembly and disassembly processes in natural food-webs"
author: Alain Danet, Loubna El Madouri, Maud Mouchet, Elisa Thébault and Colin Fontaine
date: \today
output:
  bookdown::word_document2:
    fontsize: 12pt
  bookdown::pdf_document2:
    fig_caption: true 
    keep_tex: true
    toc: true
    fontsize: 12pt
    header-includes:
       - \usepackage{natbib}
       - \usepackage{float}
       - \usepackage{multirow}
       - \usepackage{booktabs}
       - \usepackage{makecell}
       - \usepackage{setspace}
       - \doublespacing
       - \usepackage{lineno}
       - \linenumbers
    geometry: margin=2cm
    number_sections: true
bibliography: references.bib
---

```{r, echo = FALSE}
knitr::opts_chunk$set(
  cache = FALSE,
  collapse = TRUE,
  comment = "#>",
  #fig.dim = c(7, 7),
  fig.fullwidth = TRUE,
  fig.show = "hold",
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  results = TRUE,
  fig.path="figures/"
)
```

- Tentative titles:
  - How food-webs assembly and disassembly through time in natural settings?
    Lessons from freshwater fishes
  - Relationships among temporal trends of food-web structure, species richness
    and community biomass reveal contrasting assembly
    and disassembly processes
  - Temporal trends in food web structure according to richness and biomass
    reveal contrasting assembly and disassembly processes  

```{r, results = FALSE}
library(drake)
library(tidyverse)
library(magrittr)
library(cowplot)
library(viridis)
library(kableExtra)
library(sf)
mypath <- rprojroot::find_package_root_file
source(mypath("R/variable_shortcut.R")) # Define your custom code as a bunch of functions.
source(mypath("R/misc.R"))
source_dir(get_mypath("R")) # Define your custom code as a bunch of functions.

mytheme <- theme_cowplot() +
background_grid()

theme_set(mytheme)
options(knitr.table.format = "latex")
```

```{r}
loadd(rsq_table_bm_rich_mono_stable_trends)
loadd(reg_table_bm_rich_mono_stable_trends)
load(here::here("data", "semeff.rda"))
load(here::here("data", "sp_semeff.rda"))
```

```{r}
net_var_bm <- c("log_rich_std", "ct_ff", "w_trph_lvl_avg", "piel_bm",
      "piel_nind")
net_var_rich <- c("log_bm_std", "ct_ff", "w_trph_lvl_avg", "piel_bm",
      "piel_nind")
```

```{r}
loadd(slope_com_var_no_covar, st_mono_trends_stable_rich_bm)
loadd(range_data)
```
```{r}
nb_st <- unique(slope_com_var_no_covar$station) %>% length
rm(slope_com_var_no_covar)
nb_st_rich_bm <- st_mono_trends_stable_rich_bm %>% length
```

# Introduction

## Trends of biodiversity need to be assessed at multiple facets 

Multiple studies reported dramatic declines of population and community biomass
[@ceballos_biological_2017; @hallmann_more_2017; @albano_native_2021], as well
as decrease in species richness [@barnosky_has_2011; @newbold_global_2015] but
also recent studies reported non significant temporal trends in species richness
[@vellend_global_2013; @dornelas_assemblage_2014; @blowes_geography_2019], total
abundance [@klink_meta-analysis_2020], high turnover in species composition
[@dornelas_assemblage_2014; @blowes_geography_2019]. Unfortunately, studies
often focus on the temporal trend of one dimension of biodiversity
[@hallmann_more_2017; @klink_meta-analysis_2020, but see 2 in
@dornelas_assemblage_2014; @blowes_geography_2019]. However biodiversity is a
multidimensional concept and the functioning of ecosystem depends ultimately on
several dimensions of biodiversity, such as species richness, evenness and
functional composition^[1]  [@cardinale_biodiversity_2012; @duffy_why_2009], the
documentation of the trend of one biodiversity facet is likely insufficient to
understand changes in community structure and ultimately predict their
consequences on ecosystem functioning.

[^1]: Commentaire de Colin: *je pense qu'il faut lister les facet de biodiv qu'on
va etudier. sans forcement s'y limiter?* Ici je pense que la composition en role
trophique rentre dans "functional composition" sans rentrer dans le détail.

## Current knowledge mainly comes from space-for-time substitution 

Current knowledge on the links among the different facets of biodiversity mainly
comes from spatial comparison [@dunne_network_2006;
@soininen_relationship_2012; @grace_integrative_2016; @danet_species_nodate],
which is used to predict how community structure will change in time, under the
assumption of the space-for-time substitution. It supposes a homology between
variations in space and in time, i.e. that spatial sequences correspond
to temporal sequences. This method have raised criticisms
[@damgaard_critique_2019], with studies showing analogous patterns in space and
time [@blois_space_2013] or not [@johnson_testing_2008;
@adler_contrasting_2007]. Spatial turnover of species composition, dispersal
limitation, disturbance and stochastic processes have been hypothesised to be
responsible for the non-compliance of space-for-time substitution
[@adler_contrasting_2007; @blois_space_2013]. The recent increase in the availability
of temporal monitoring of ecological communities makes possible to address
biodiversity trends for multiple facets. 

## Temporal variation of food-webs is largely unknown

More dramatic is that the temporal trends of biodiversity generally neglect
species interactions. Although species interactions determine for a large part
community composition, species coexistence and ecosystem functioning
[@chesson_mechanisms_2000; @thebault_food-web_2003; @oconnor_general_2017].
Furthermore, species interactions can imply tremendous secondary extinctions
[@paine_note_1969; @dunne_network_2002]. In food-webs, spatial comparisons in
empirical and theoretical studies generally reported that trophic level
positively scales to community biomass [@wang_biodiversity_2018;
@danet_species_nodate]. Trophic level has also been shown to stabilise the
temporal variation of community biomass [@shanafelt_stability_2018;
@danet_species_nodate]. Connectance, which measures the degree of generalism in
a network, was shown to increase robustness to extinction [@dunne_network_2002].
However, the temporal variation of food-web structure is largely unknown
[@kortsch_disentangling_2021]. Food-web temporal variation are often reported
across small time-steps [@warren_spatial_1989; @pecuchet_novel_2020;
@kaartinen_high_2012]. Our knowledge on the variability of food-web structure in
time are even more scarce and particularly how those temporal variations are
linked to the temporal variations of other aspects of biodiversity such as
species richness and community biomass. Spatially, connectance has been shown to
be negatively related to species richness in empirical food-webs [reviewed in
@dunne_network_2006]. Connectance has been shown to scale positively or
negatively with community biomass in theoretical models
[@thebault_food-web_2003; @poisot_trophic_2013]. Average trophic level was
previously shown to scale negatively with species richness
[@danet_species_2021].  In order to improve our knowledge on the consequences of
biodiversity trends such as community biomass and species richness, it is thus
crucial to assess how biomass and species richness temporal trends are
associated to temporal trends of food-web structure. 

Even how the temporal trends of community biomass are related to temporal
trends of species richness is still questionned in natural settings, especially
in food-webs. Our knowledge on the relationships between food-web structure and
other facets of biodiversity often comes from the comparison of food-web
snapshots along spatial gradient, raising the question of the validity of
space-for-time substitution to infer consequences of species richness and
community biomass variations on food-web structure.

The increasing availability ecological temporal series and the development of
methods to reconstruct food-webs [@bonnaffe_comparison_2021;
@gravel_inferring_2013; @danet_species_nodate] makes possible to assess the
relationships among several biodiversity facets, including food-web structure.
We used the standardized monitoring of fish freshwater communities on the period
1995-2018 over France, documenting the individual size of fishes in
400 sites during ten years or more. We then reconstruct around 4000 food-webs
based on allometric relationships and food diet data. We questionned i) how
temporal trends of food-web structure are  linked to trends of community biomass
and trends in species richness? ii) Are the relationships observed in time the
same as those observed in space, i.e. is the space-for-time substitution valid? 

---
## Variations of community biomass and species richness are predicted to affect
community structure #Changes of species richness and community biomass are
indeed
#predicted to affect community structure. The positive link between biodiversity
#and ecosystem functioning in experimental studies predict that loss and
#gain of species richness should respectively result in loss and gain of
#community biomass [@tilman_biodiversity_2014; @pennekamp_biodiversity_2018]. But
#this relation is not always found in natural settings [@grace_integrative_2016;
#@li_relationship_2018; @maureaud_biodiversityecosystem_2019].
#
#Variations of species richness can also result in variation of evenness, i.e.
#equitability of species abundances or biomasses. Meta-analysis reported that
#higher evenness of abundances is linked to higher plant biomass in grasslands
#and primary productivity in marine ecosystems [@soininen_relationship_2012].
#Furthermore, studies reported that higher evenness plays a role of insurance in
#face of perturbations [@wittebolle_initial_2009]. Indeed, most studies reported
#positive relationship between species richness and evenness, but also neutral
#and negative ones [@soininen_relationship_2012; @ma_species_2005;
#@maureaud_biodiversityecosystem_2019].
## Variations of community biomass and species richness are predicted to affect food-web structure

---


# Methods

## Data

We used a monitoring of freshwater fishes conducted all over France and
conducted by the Office Français de la Biodiversité (OFB, previously known as
ONEMA and AFB). The sampling protocols were standardized since 1995 and a
complete description of the sampling process can be found in
@danet_species_nodate (main text and appendixS2). The fishes are sampled using
electrofishing all across the streams in shallow streams and over the bank by
boat in deeper streams. All the fishes are counted and the bodysize of fishes are
recorded for a sample of them, enabling the estimate the distribution of
individual bodysize by species for each sampling [@bonnaffe_comparison_2021;
@danet_species_nodate].

## Data selection

We selected the sites that have been monitored at least 10 years on the
1995-2018 period, with the same sampling protocol over time. We selected
one sampling a year by site. In each site, we ensured low temporal heterogeneity
in sampling period by selecting sampling that were performed in the same period,
leading to a mean standard deviation of sampled month in each site of three
weeks [@danet_species_nodate]. Those steps leads to the selection of 
`r nb_st` sites (Figure \@ref(fig:matmet)A).

## Biomass 

We first inferred the body mass of each fish individual considering an allometric
law, $B_i = 0.01 \times l_i^{3.03}$, $B_i$ being the biomass expressed in gram and $l_i$ the
body length of the individual $i$ expressed in millimetres  [@froese_cube_2006]. Then the
biomass of each species and community biomass were obtained by summing the body
mass of individuals. Finally, the biomass was reported to the sampled surface
(in $m^2$) to account for sampling effort.
 
## Food-web inference 

We inferred food-web structure in two steps [@bonnaffe_comparison_2021;
@danet_species_2021]: (1) we first computed the metaweb, describing the
potential trophic interactions among all size classes species, (2) then we
extracted each yearly snapshot of food-webs by extracting species size classes
and their interactions according to their presence in a given sampling event.
 
We inferred the metaweb according to ontogenic diet data and body size
[@gravel_inferring_2013; @poisot_structure_2016; @brose_predator_2019;
@bonnaffe_comparison_2021; @danet_species_2021]. The method is extensively
described in @bonnaffe_comparison_2021 and @danet_species_2021. The food diet of
stream fishes changes along their life cycle or stage, therefore according to
their body size. Each fish species was divided in nine size classes, named
"trophic species", equally distributed in their observed body size range. Thus,
a trophic species is a group of individuals of the same species and size class
that are expected to share the same preys and predators because trophic
interactions are largely determined by predator-prey size ratio
[@brose_allometric_2006]. We also added seven nodes present in the ontogenic
food diet database: detritus, biofilm, phytoplankton, zooplankton, macrophages,
phytobenthos and zoobenthos.  The resulting metaweb contained 45 fish species
divided into nine size classes plus 7 resource nodes, summing up to 412 nodes.
Consideration of size classes, i.e.  trophic species instead of species,
improves inference of trophic interactions [@jennings_weak_2001].

We determined the feeding interactions of trophic species according to their
species identity and their body size. The diet database described two or three
life stages by fish species, each one being delimited by body size
[@bonnaffe_comparison_2021; @danet_species_nodate]. The ontogenic fish diet
database was filled according to fishbase (Froese et al. 2021) and literature
[@bonnaffe_comparison_2021; @danet_species_nodate].

The feeding interactions among fishes were based on the body size ratio
between predators and preys. We defined the predation window of a
piscivorous trophic species as 3% to 45% of its midpoint
[@mittelbach_ontogeny_1998; @claessen_impact_2002; @hart_handbook_2008].  A
trophic link was defined between the piscivorous trophic species and all the
trophic species whose midpoint in body size range was included in the predation
window.  The fish-resource trophic links were set between the trophic species
and the resources nodes according to the food items of their size class.
Finally, the feeding interactions between resources were defined according to the
literature [@allan_stream_2007; @hart_handbook_2008].

## Community and food-web structure

At each site, yearly food-webs were described by their community biomass,
species richness and the evenness of biomass across species. The evenness was
quantified with the Pielou index, computed as the Shannon diversity index
divided by the number of species ($P = \frac{H'}{N}$, with $H'$ being the
Shannon diversity index and $N$ the number of species). Yearly food-web
structure was described by their connectance, describing the degree of
generalism in a network [@dunne_network_2006; @delmas_analysing_2019]. It was
computed as the ratio between the number of actual links and the number of
potential links ($C = \frac{L}{S(S-1)}$, with $L$ being the number of links and
$S$ the number of trophic species). We also computed the average trophic level,
weighted by the biomass of the trophic species. The trophic level of a trophic
species was computed recursively as 1 added to the mean trophic level of the
preys that it consumes [@herendeen_ecological_2008].


## Temporal trends of food-web 

To characterize the links among the temporal trends of network and community
structure and the temporal trends of community biomass and species richness, we
characterized the temporal trajectories of food-web structure at each site. We
modeled a linear relationship between food-web structure and
time with a second order polynome, which allows to assess both the direction and the monotony of temporal
trends [@rigal_method_2020]. We selected the sites that displayed monotonic
trends for these variables, i.e. the ones for which the second order polynomial
term was non significant according to t-tests, to avoid the inclusion of many
types of biomass and species richness trends (i.e. accelerating, decelerating,
etc...), . Over the `r nb_st` monitored sites, the selection procedure resulted in 
`r nb_st_rich_bm` sites for community biomass and species richness analysis.
However, the results were robust to the inclusion of non monotonic trends (Fig.
SXX).

There was a clear relationship between the size of the communities and their
temporal dynamics. Communities that displayed low community biomass at the
beginning of their monitoring tend to display a biomass increase through time
and reversely, we observed the same pattern for species richness. We
log-transformed (natural logarithm) community biomass and species richness to model their trends,
which decreased the former effect (Fig. SXX). Temporal
trends of community biomass and species richness were thus expressed in rate of
change by year.


## Spatial

To assess the validity of the space-for-time substitution hypothesis, we
compared the relationships among food-web structure in time to the ones observed
in space. To do so, we selected the same sites that were used
for the temporal analysis. We summarised temporal series of each station by the
median value over time of each facet of food-web structure described above.
 
# Statistical analysis

We modelled the relationships among food-web structure, that is
connectance and average trophic level, and community biomass ($dB$) and species
richness ($dR$) with Structural Equation Models. We modelled a it such as species
richness is related to community biomass and food-web structure. In
turn community biomass was related to food-web structure. We computed one
structural equation model to assess the relationships among the temporal trends
and one for the relationships over the spatial gradient. As spatial variation of
food-web structure are partly driven by environmental gradients, so we
controlled relationships among variables by adding two PCA axis
synthesizing respectively (1) stream gradient from upstream to downstream and
(2) enrichment (Fig. \@ref(fig:matmet)). Enrichment was characterized by the
average Biological Oxygen Demand [BOD, @mallin_factors_2006][^2]. We further
added a random effect of the hydrographic basin on the intercept.

In order to control for the uncertainties of the estimated temporal trends, each
temporal trend was weighted by the inverse of the sum of the standard errors
of the estimated trends, i.e. estimated slopes for the response and the
explicative variables ($w_j = \dfrac{1}{\sum{e_j}}$, $w_j$ being the
weight, and $s_{e_j}$ the standard error on the
temporal trends of the variables).

The coefficients of the Structural Equation Models were computed with
PiecewiseSEM R package [@lefcheck_piecewisesem_2016]. The coefficients were
standardizated and the confidence intervals were computed with semEff R package
[@murphy_semEff_2021]. Confidence intervals were obtained by bootstrapping the
linear models 1000 times and computing adjusted bootstrap percentile interval
(BCa), which are adjusted for asymetric distribution of resampling.

All the statistical models displayed low multicollinearity (Variance inflation
factor < 3, Table SXX).  We visually inspected the residuals of the linear
models.

```{r}

fig_mat_cap <- paste0("Using  sites of stream fishes in French streams that
  have been monitored at least 10 years, 1) we infered the food-web at each site
and each sampling event based on ontogenic food diet information for each
species and predator-prey body size ratio. 2) We computed the temporal trends
and the median of community biomass, species richness, connectance, average
trophic level and evenness of biomass at each site. 3) We then assessed the
relationships among a) temporal trends of food-web structure. We also assessed
the spatial relationships among median food-web structure while controlling for
the environmental gradient with two axis of a rotated PCA. The first axis of the
PCA is related to the stream gradient from upstream to downstream while the
second is related to enrichment (BOD) and site altitude.")

```

```{r matmet, fig.cap=fig_mat_cap, out.width="80%"}
knitr::include_graphics(get_mypath("figures", "mat_met_inkscape.pdf"))
```

# Results

```{r}
loadd(rsq_sp_mod, summary_table, sp_models, model_summary)

loadd(rsq_table_bm_rich_mono_stable_trends, sp_rsq_table_bm_rich_mono_stable_trends)

loadd(rigal_classification)
```

```{r}
log_trends_percent <- rigal_classification %>%
  unnest(classif) %>%
  filter(variable %in% c("log_bm_std", "log_rich_std")) %>%
  select(variable, station, linear_slope, linear_slope_strd_error) %>%
  mutate(
    slp_percent = round((exp(linear_slope) - 1) * 100),
    std_err_percent = round((exp(linear_slope_strd_error) - 1) * 100)
  )
resume_log_trends <- log_trends_percent %>%
  group_by(variable) %>%
  summarise(
    mean = mean(slp_percent, na.rm = TRUE),
    sd = sd(slp_percent, na.rm = TRUE))
```


```{r}
class_trends_bm_rich <- rigal_classification %>%
  filter(variable %in% c("log_bm_std", "log_rich_std")) %>%
  unnest(classif) %>%
  select(variable, station, direction, acceleration, shape_class)

res_trends <- class_trends_bm_rich %>%
  filter(acceleration == "constant") %>%
  group_by(variable, direction) %>%
  summarise(n = n()) %>%
  group_by(variable) %>%
  mutate(total = sum(n), percent = round(n / sum(n) * 100))

x_var <- c("log_bm_std", "log_rich_std")
stable_st_var <- map(x_var,
  ~class_trends_bm_rich[
    class_trends_bm_rich$variable == .x &
    class_trends_bm_rich$direction == "stable",
      ]$station
)
names(stable_st_var) <- x_var

#sum(stable_st_var[["log_bm_std"]] %in% stable_st_var[["log_rich_std"]] == TRUE) / length(stable_st_var[["log_bm_std"]])

#sum(stable_st_var[["log_rich_std"]] %in% stable_st_var[["log_bm_std"]] == TRUE) / length(stable_st_var[["log_rich_std"]])
```

```{r}
loadd(std_table_bm_rich_mono_stable_trends)
std <-
  std_table_bm_rich_mono_stable_trends %>%
  mutate(
    type = recode(type, spatial = "sp", temporal = "tps"),
    response = recode(response, log_bm_std = "bm", log_rich_std = "rich", ct_ff
      = "ct", piel_bm = "p_bm", piel_nind = "p_n", w_trph_lvl_avg = "tlvl"),
    term = recode(term, log_bm_std = "bm", log_rich_std = "rich")
    ) %>%
  rename(t = type, rep = response, sest = std_estimate) %>%
  mutate_at(vars(sest, stdse), ~round(.x, 2))
tps_bm <- std %>%
  filter(t == "tps", term == "bm")

tps_bm_sest <- tps_bm$sest
names(tps_bm_sest) <- tps_bm$rep
```

```{r}
tps_r <- std %>%
  filter(t == "tps", term == "rich")

tps_r_sest <- tps_r$sest
names(tps_r_sest) <- tps_r$rep
```

```{r}
sp_b <- std %>%
  filter(t == "sp", term == "bm")
sp_b_sest <- sp_b$sest
names(sp_b_sest) <- sp_b$rep

sp_r <- std %>%
  filter(t == "sp", term == "rich")
sp_r_sest <- sp_r$sest
names(sp_r_sest) <- sp_r$rep
```


```{r}
rsq_ct <- rsq_table_bm_rich_mono_stable_trends %>%
  filter(Response == "ct_ff") %>%
  .$R.squared %>%
  round(., 2)

rsq_bm <- rsq_table_bm_rich_mono_stable_trends %>%
  filter(Response == "log_bm_std") %>%
  .$R.squared %>%
  round(., 2)

rsq_tlvl_sp <- sp_rsq_table_bm_rich_mono_stable_trends %>%
  filter(Response == "w_trph_lvl_avg") %>%
  .$Conditional %>%
  round(., 2)

rsq_ct_sp <- sp_rsq_table_bm_rich_mono_stable_trends %>%
  filter(Response == "ct_ff") %>%
  .$Conditional %>%
  round(., 2)
```
Over the sampling sites in the dataset, we found that
`r res_trends[res_trends$variable == "log_bm_std", ]$total[1]` stations displayed monotonic trends for biomass. Among them, 
`r res_trends[res_trends$variable == "log_bm_std" & res_trends$direction == "stable", ]$percent`%
were classified as stable,
`r res_trends[res_trends$variable == "log_bm_std" & res_trends$direction == "decrease", ]$percent`%
as decreasing,
`r res_trends[res_trends$variable == "log_bm_std" & res_trends$direction == "increase", ]$percent`%
as increasing. Regarding the species richness, we found that
`r res_trends[res_trends$variable == "log_rich_std", ]$total[1]` stations displayed monotonic trends.
`r res_trends[res_trends$variable == "log_rich_std" & res_trends$direction == "stable", ]$percent`%
were classified as stable,  
`r res_trends[res_trends$variable == "log_rich_std" & res_trends$direction == "decrease", ]$percent`%
as decreasing, and 
`r res_trends[res_trends$variable == "log_rich_std" & res_trends$direction == "increase", ]$percent`% as increasing.

Overall, we found relatively low in the explicative power of statistical
models linking temporal dynamics of food-web structure and the one of community
biomass and species richness spanning from $R_{adj}^2= `r rsq_ct`$ for
connectance to $R_{adj}^2= `r rsq_bm`$ for community biomass (Table SXX).
The models over the spatial gradient were more performant, with
$R_{cond}^2$ varing from $`r rsq_tlvl_sp`$ for the average trophic level to
$`r rsq_ct_sp`$ for connectance (Table SXX), $R_{cond}^2$ being the
$R^2$conditional to the random effect. 

---
#Overall, we found no significant effect of the temporal gain or losses of
#communinity biomass biomass and species richness on the relationship between the
#temporal trends of community structure and that of biomass and species richness
#(Table \@ref(tab:aov)).
---

```{r}
loadd(sp_fig1_2_bm_rich_mono_stable_trends,
  pred_bm_rich_mono_stable_trends)

fig1_2 <- get_plot_rich_bm(
  predict_plot = pred_bm_rich_mono_stable_trends,
  get_list = TRUE,
  rm_legend = FALSE,
  bm_x = "log_bm_std",
  bm_y = c("ct_ff", "w_trph_lvl_avg"), #, "piel_nind"
  rich_y = c("ct_ff", "w_trph_lvl_avg", "log_bm_std"), #, "piel_nind"
  rich_x = "log_rich_std"
  )
p_bm <- fig1_2$bm

p_sp_bm <- sp_fig1_2_bm_rich_mono_stable_trends$bm[c("log_rich_std", "ct_ff", "w_trph_lvl_avg")]
```



```{r}
fig_bef_cap <- paste0(
  "Relationship between the temporal trends of community biomass 
  and the one of species richness. Red line correspond to the predictions of the
  linear models. The lines surrounding points display the standard error
  associated to the temporal trends. The histograms display the distribution of
  response and predictive variables."
)
```

```{r}
library(ggExtra)
coeff_bef <- c(
  rsq = rsq_table_bm_rich_mono_stable_trends %>%
    filter(Response == "log_bm_std") %$%
    unlist(.[, c("R.squared")]),
  reg_table_bm_rich_mono_stable_trends %>%
    filter(response == "log_bm_std", term == "log_rich_std") %$%
    unlist(.[, c("estimate", "std.error", "std_estimate", "stdse")])
  ) %>%
round(., 2)

beta_rsq <- function(
  rsq = NULL,
  beta = NULL,
  se = NULL) {

  if (!is.null(rsq)) {

    tmp <- "paste(
    beta, \" (s.e.) \", \" = \",
    mybeta, \" (\", myse, \"), \",
    italic(R)^2, \" = \", myrsq
    )"
str_replace_all(tmp,
  c(
    "myrsq" =  as.character(rsq),
    "mybeta" = as.character(beta),
    "myse" = as.character(se)
  )
)

  } else {

    tmp <- "paste(
    beta, \" (s.e) \", \" = \",
    mybeta, \" (\", myse, \") \" )"
str_replace_all(tmp,
  c(
    "mybeta" = as.character(beta),
    "myse" = as.character(se)
  )
)

  }


}

scale_xy_log_trends <- function(breaks = NULL, axis = "y", sep ="\n") {
  log_to_percent <- round((exp(breaks) - 1) * 100)
  labels <- paste0(breaks, sep, log_to_percent, " %")

  if(axis == "y") {
    fun <- scale_y_continuous
  } else {
    fun <- scale_x_continuous
  }

  fun(breaks = breaks, labels = labels)

}
```


We found a strong positive relationship between the temporal trends of community
biomass and the ones of species richness ($r_\delta = `r tps_r_sest["p_bm"]`$,
Fig. \@ref(fig:bmr) B), meaning that both temporal trends
had the same direction in average. At the sites 
where species richness decreased over time, community biomass also decreased
over time. On the other hand, at the sites where species richness increased over
time, community biomass also increased over time. Along the spatial gradient, we also
found a positive relationship between median community biomass and median
species richness, but half the strength as the temporal one
($r_\delta = `r sp_b_sest["rich"]`$).

The temporal trends of connectance were positively linked with the ones of
community biomass ($r_\delta = `r tps_bm_sest["ct"]`$), also meaning that both
temporal trends had the same direction in average. That is, the sites where
food-web connectance decreased over time also had community biomass that
decreased over time and reversely. It suggests that communities that decreased
in biomass over time loose generalist predators over time, as connectance
measures the degree of generalism, and reversely that communities
gaining biomass over time also gain generalist predators. Spatially, we also found
a positive relationship between median connectance and median species
richness ($r_\delta = `r sp_b_sest["ct"]`$). We found a negative 
relationship between the temporal trends of connectance and the
ones of species richness ($r_\delta = `r tps_r_sest["ct"]`$, Fig. \@ref(fig:bmr)D)
while we found negative relationship three times stronger between median connectance and
median species richness along the spatial gradient 
($r_\delta = `r sp_r_sest["ct"]`$, Fig. \@ref(fig:std)).

The temporal trends of average trophic level had a strong positive
relationship with the ones of community biomass 
($r_\delta = `r tps_bm_sest["tlvl"]`$, Fig. \@ref(fig:bmr)B), meaning
that sites where community biomass decreased over time, average trophic level
decreased over time and *vice versa*. It means that in communities loosing biomass
over time, the average biomass of the food-web moved down to lower trophic level
and *vice versa*. We also found a positive relationship between
median average trophic level and median community biomass in space, but half the
strength as the temporal one ($r_\delta = `r sp_b_sest["tlvl"]`$, Fig.
\@ref(fig:std)). The temporal trends of average trophic level was unrelated to
the ones of species richness. It suggests that in communities either loosing or
gaining species richness over time, the location of average biomass along
trophic level did not significantly change according to species richnnes.
However, we found a strong negative relationship in space 
($r_\delta = `r sp_r_sest["tlvl"]`$, Fig. \@ref(fig:std)).

```{r}
sp_semeff_tab <- from_semEff_to_table(sp_semeff)
semeff_tab <- from_semEff_to_table(semeff)
semeff
semeff_tot <- rbind(
  tibble(semeff_tab, model = "temporal"),
  tibble(sp_semeff_tab, model = "spatial")
  ) %>%
filter(
  !predictor %in% c("log_RC1", "log_RC2"),
  effect_type != "mediators"
)
```

```{r}
semeff_tab_coeff <- semeff_tab %>%
  mutate(across(where(is.numeric), ~round(., 2))) %>%
  mutate(eci = paste0(effect, " [", lower_ci, ";", upper_ci, "]"))

sp_semeff_tab_coeff <- sp_semeff_tab %>%
  mutate(across(where(is.numeric), ~round(., 2))) %>%
  mutate(eci = paste0(effect, " [", lower_ci, ";", upper_ci, "]")) %>%
  filter(! predictor %in% c("log_RC1", "log_RC2"))

ctsi <- semeff_tab_coeff %>%
  filter(response == "ct_ff", effect_type == "indirect")
ctstr <- semeff_tab_coeff %>%
  filter(response == "ct_ff", effect_type == "total",
    predictor == "log_rich_std")

ctspi <- sp_semeff_tab_coeff %>%
  filter(response == "ct_ff", effect_type == "indirect")
ctsptr <- sp_semeff_tab_coeff %>%
  filter(response == "ct_ff", effect_type == "total",
    predictor == "log_rich_std")

wtsi <- semeff_tab_coeff %>%
  filter(response == "w_trph_lvl_avg", effect_type == "indirect")
wtstr <- semeff_tab_coeff %>%
  filter(response == "w_trph_lvl_avg", effect_type == "total",
    predictor == "log_rich_std")

wtspi <- sp_semeff_tab_coeff %>%
  filter(response == "w_trph_lvl_avg", effect_type == "indirect")
wtsptr <- sp_semeff_tab_coeff %>%
  filter(response == "w_trph_lvl_avg", effect_type == "total",
    predictor == "log_rich_std")
```


The structural model on the temporal trends of food-web structure reveals that
the species richness has a direct negative effect on connectance but also a
negative one, twice lower than the former, through community biomass
($r_\delta$ = `r ctsi[["eci"]]`). It resulted a relatively weak total negative
effect of species richness on connectance (`r ctstr[["eci"]]`). Spatially,
we also found a positive indirect effect of richness on connectance through
community biomass but a weak one (`r ctspi[["eci"]]`), resulting in a strong negative total
effect of richness on connectance (`r ctsptr[["eci"]]`).

The relationships among temporal trends showed a indirect positive effect of
species richness on average trophic level (`r wtsi[["eci"]]`), resulting in a total positive
effect of species richness on average trophic level (`r wtstr[["eci"]]`). Over the spatial
gradient, we found the same positive indirect effect of richness through
community biomass (`r wtspi[["eci"]]`). But as the direct effect of richness on connectance
was strongly negative, it resulted in a total strong negative effect of species
richness on connectance over the spatial gradient (`r wtsptr[["eci"]]`).


```{r}
fig_bm_cap <- paste0(
  "Relationship between community structure and community biomass. Left panel
  displays the relationships between the temporal trends of community structure
  and the one of community biomass. Lines correspond to the predictions of the
  linear models while the points are colored according the median community
  biomass of the three first years of the given temporal series. The lines
  surrounding each point represent the standard error associated to the temporal
  trends. Right panel displays the
  spatial relationship between median community structure over time and the
  median community biomass over time."
)

fig_rich_cap <- paste0(
  "Relationship between community structure and species richness. Left panel
  displays the relationships between the temporal trends of community structure
  and the one of species richness. Lines correspond to the predictions of the
  linear models while the points are colored according the median species
  richness of the three first years of the given temporal series. The lines
  surrounding each point represent the standard error associated to the temporal
  trends. Right panel displays the spatial relationship between median community
  structure over time and the median species richness over time."

)
```



```{r}
fig_bm_rich_cap <- paste0(
  "Relationships between the temporal trends of food-web structure
  and the ones of community biomass (left panel, A, C, E) species richness (right panel, B, D, F).
  The lines surrounding each point display the standard errors associated to
  the estimated temporal trends. Red and black lines represent respectively
  significant and non-significant slopes, both lines displays prediction from
  the Ordinary Least Squares model. The histograms display the distribution of response and predictive
  variables. Labels display the unstandardised slope coefficients and their
  standard errors (see Fig. \\ref{fig:std} for the standardized coefficients).
  $R^2$ are displayed only on the right panel, as it is the same model for both
  panels.")

```

```{r bef, fig.cap=fig_bef_cap, out.width="50%"}
lab_log_rich <- expression(atop("Log species richness ("*m^{-2}*")","trend slope (log / % per year)"))
lab_log_bm <- expression(atop("Log community biomass ("*g.m^{-2}*")", "trend slope (log / % per year)"))

p_bef <- fig1_2$rich$log_bm_std +
  labs(
    y = lab_log_bm,
    x = lab_log_rich
  ) +
scale_xy_log_trends(breaks = c(-.10, -.050, 0, .050, .10), axis = "x") +
scale_xy_log_trends(breaks = c(-.4, -.2, 0, .4, .2), axis = "y", sep = " / ") +
    theme(
      axis.text = element_text(size = 8),
      axis.title = element_text(size = 10)
      )

```

```{r}
fig2 <- fig1_2
fig2$rich$log_bm_std <- NULL
fig2$rich <- map(fig2$rich,
  ~.x +
    theme(
      axis.text = element_text(size = 8),
      axis.title = element_text(size = 10)
      )
  )
fig2$bm <- map2(fig2$bm, names(fig2$rich),
  ~ .x + theme(
    axis.text = element_text(size = 8),
    axis.title = element_text(size = 10)
    ) +
  labs(
    y = paste0(var_replacement()[.y],
      "\ntrends (per year)"),
    x = lab_log_bm
  ) +
  scale_xy_log_trends(breaks = c(-.40, -.20, 0, .20, .40), axis = "x")
)
# Delete redondant legend
fig2$bm[[1]] <- fig2$bm[[1]] + theme(
  axis.text.x = element_blank(),
  axis.ticks.x = element_blank(),
  axis.title.x = element_blank()
  )
  

fig2$rich <- map(fig2$rich,
  ~ .x + theme(
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.title.y = element_blank()
  ) +
  labs(x = lab_log_rich) +
  scale_xy_log_trends(breaks = c(-.10, -.050, 0, .050, .10), axis = "x")
  )
fig2$rich[[1]] <- fig2$rich[[1]] + theme(
  axis.text.x = element_blank(),
  axis.ticks.x = element_blank(),
  axis.title.x = element_blank()
  )
  

```

```{r, eval = FALSE}
# Add beta and Rsq
for (i in seq_along(fig2$rich)) {

  resp_var <- names(fig2$rich)[i]

  coeff_rich <- c(
    rsq = rsq_table_bm_rich_mono_stable_trends %>%
      filter(Response == resp_var) %$%
      unlist(.[, c("R.squared")]),
    reg_table_bm_rich_mono_stable_trends %>%
      filter(response == resp_var, term == "log_rich_std") %$%
      unlist(.[, c("estimate", "std.error", "std_estimate", "stdse")])
    ) %>%
  round(., 2)

  coeff_bm <- reg_table_bm_rich_mono_stable_trends %>%
    filter(response == resp_var, term == "log_bm_std") %$%
    unlist(.[, c("estimate", "std.error", "std_estimate", "stdse")]) %>%
    round(., 2)

  # Add coeff:
  fig2$rich[[resp_var]] <- fig2$rich[[resp_var]] +
  annotate("text", x = -.10, y = Inf, vjust = 1, hjust = 0,
    size = 2,
    parse = T,
    label = beta_rsq(
      rsq = coeff_rich["rsq"],
      beta = coeff_rich["estimate"],
      se = coeff_rich["std.error"]
    )
  )
  fig2$bm[[resp_var]] <- fig2$bm[[resp_var]] +
  annotate("text", x = -.4, y = Inf, vjust = 1, hjust = 0,
    size = 2,
    parse = T,
    label = beta_rsq(
      rsq = NULL,
      beta = coeff_bm["estimate"],
      se = coeff_bm["std.error"]
    )
  )
}
```

```{r}
# Add histograms
p_bef2 <- p_bef +
  theme(
  axis.text.x = element_blank(),
  axis.ticks.x = element_blank(),
  axis.title.x = element_blank()
  ) 
p_bef_hist <- ggMarginal(p_bef2, type = "histogram")
#fig2$bm[[1]] <- ggMarginal(fig2$bm[[1]], type = "histogram", margins = "x")
fig2$rich[[1]] <- ggMarginal(fig2$rich[[1]], type = "histogram", margins = "y")
fig2$rich[[2]] <- ggMarginal(fig2$rich[[2]], type = "histogram", margins = "y")
```

```{r}
sem_cap <- "Structural equation models on the temporal trends of the food-web
structure. The path display the standardized slopes and their associated 95%
  confidence intervals."
```


```{r sem, fig.cap = sem_cap}
ti <- magick::image_read(here::here("figures", "sem_tps_avg_weight_ok.svg"),  density = 300)
p <- ggdraw() +
  draw_image(ti,
    x = 0, y = 0, hjust = 0, vjust = 0, width = .9, height = 1)
```



```{r bmr, out.width="100%", fig.height=7, fig.cap=fig_bm_rich_cap}
#p <- draw_image(here::here("figures", "sem_tps_avg_weight_ok.pdf"),
#  x = 1, y = 1, hjust = 1, vjust = 1, width = 0.13, height = 0.2)
biplot_model <- plot_grid(
  plot_grid(NULL, p_bef_hist,
    labels = c("", "A"), ncol = 2,
    rel_widths = c(.54, 1)
    ),
  plot_grid(
  plot_grid(plotlist = fig2$bm,
    ncol = 1, labels = c("B", "D"),
    hjust = -5.5, vjust = 1.75,
    rel_heights = c(.85, 1)
    ),
  plot_grid(plotlist = fig2$rich,
    ncol = 1, labels = c("C", "E"),
    hjust = -2, vjust = 1.75,
    rel_heights = c(.85, 1)
    ),
  ncol = 2,
  rel_widths = c(.9, 1)
  ),
  nrow = 2,
  rel_heights = c(.55, 1)
)
sem_p <- plot_grid(p, biplot_model, ncol = 2, rel_widths = c(.4, .6))

save_plot(
  filename = here::here("paper", "figures", "biplot_tps.png"),
  biplot_model, nrow = 3, ncol = 2, base_asp = 1)
save_plot(
  filename = here::here("paper", "figures", "sem_p.png"),
  sem_p, nrow = 3, ncol =3)
sem_p
```


```{r}
std_cap <- paste0(
  "Assessment of the space-for-time hypothesis. Standardized coefficients
  ($r_\\delta$) derived from the spatial and temporal Structural Equation
  Models. The left, middle and right panels display respectively the direct,
  indirect and total effects of community biomass and species richness on the
  Average trophic level (top panel), the connectance (middle panel) and the
  community biomass (bottom panel) The lines display the confidence intervals at
  95%.")

```

```{r std-old, eval = FALSE, fig.cap=std_cap, fig.width=6}
#loadd(fig_std_coef)
std_table_bm_rich_mono_stable_trends %>%
  filter(
    term %in% c("log_rich_std", "log_bm_std"),
    !response %in% "piel_nind") %>%
  mutate_at(vars(term, response), ~str_replace_all(., var_replacement(
        several_lines = TRUE))) %>%
  mutate(
    type = str_to_sentence(type),
    type = factor(type, levels = c("Temporal", "Spatial"))) %>%
  ggplot(aes(y = std_estimate, x = response, fill = type)) +
  viridis::scale_fill_viridis(begin = 0.5, end = 1, discrete = TRUE) +
  facet_grid(rows = vars(term)) +
  geom_col(position = position_dodge(width = .9)) +
  geom_linerange(aes(ymin = std_estimate - stdse, ymax = std_estimate + stdse),
    position = position_dodge(width = .9)) +
  labs(
    x = "Response variables",
    y = expression(paste("Standardized slope coefficients ", r[delta])),
    fill = "Model") +
  theme(legend.position = c(0.6, .05),
    legend.direction = "horizontal",
    text = element_text(size = 8), axis.text = element_text(size = 8)) +
  scale_y_continuous(sec.axis = sec_axis(~ ., name = "Predictive variable",
      breaks = NULL, labels = NULL))
```

```{r std, fig.cap=std_cap, fig.width=6, fig.height = 9}
semeff_tot %>%
  mutate(
    response = var_replacement()[response],
    predictor = var_replacement()[predictor]
    ) %>%
  ggplot(aes(x = predictor, y = effect, fill = effect_type)) +
  geom_col(
    position = position_dodge(width = 0.4), width = .4) +
  geom_hline(yintercept = 0) +
  geom_linerange(
    aes(ymin = lower_ci, ymax = upper_ci),
    position = position_dodge(width = 0.4)
    ) +
  facet_grid(rows = vars(response), cols = vars(model)) +
  labs(
    x = "Predictor",
    y = expression(paste("Standardized slope coefficients ", r[delta])),
    fill = "Effect type") +
  theme(axis.text.x = element_text(angle = 20, hjust = 1))
```

# Discussion

Most temporal trends of for species richness and community biomasss were
classified as stable. Roughly the same number of stations displayed temporal
decrease and increase for species richness, and twice more stations displayed
decrease in community biomass than increase. This result is in accordance with
previous meta analysis on species richness trends of vertebrate in marine,
freshwater and terrestrial systems, which show no change in species richness in
average [@dornelas_assemblage_2014; @blowes_geography_2019] but an increase in
total abundance [@klink_meta-analysis_2020].

## Species richness and community biomass are positively linked in space and time

Spatially and temporally, species richness scaled positively with community
biomass. Spatially, this result is in accordance with previous studies in stream
communities [@woods_testing_2020; @danet_species_nodate] but also in grasslands,
salt marches and forests [@hector_plant_1999; @tilman_biodiversity_2014;
@wu_relationship_2015; @li_relationship_2018; but see @grace_integrative_2016].
Therefore, our results confirm that Biodiversity-Ecosystem functioning
prediction also hold in the temporal dynamics of food-webs. The positive
relationship between species richness and total biomass might be due to positive
complementarity in resource use [@carey_determining_2011], which is held by
niche differentiation [@loreau_biodiversity_1998; @loreau_partitioning_2001] or
to the higher probability of getting high biomass species with higher species
richness [@loreau_biodiversity_2001].

## Food-web structure changes according to the temporal trends of community biomass and species richness 

While we found a strong relationship between the temporal trends of community
biomass and the one of species richness, our results suggest that temporal
trends in community biomass and species richness are associated with very
different temporal trends on the connectance and average trophic level. Indeed,
temporal trends of connectance and average trophic level were positively
associated to the temporal trends of community biomass while we found
that species richness temporal trends was negatively and no
significantly related to connectance and average trophic level respectively. All
together, it suggests that temporal trends of community biomass and species
richness are related to different assembly and disassembly processes in
food-webs. 

The temporal trends of connectance were positively linked to that of community
biomass, meaning that when connectance increased through time when community
biomass increased through time in a given site. Reversely, connectance decreased
in food-webs when community biomass decreased through time. Indeed, food-webs
have a highly nested structure, in a way that feeding trophic links of species
at lower trophic level are a subset of the ones of species found at higher
trophic level [@kondoh_food_2010; @nordstrom_nestedness_2015]. It is because
feeding interactions are largely driven by body size, consumers being larger
than their preys [@brose_allometric_2006; @woodward_body_2005]. We also found
that community biomass losses through time were associated to a temporal
decrease of average trophic level and that community biomass temporal gains were
associated to temporal increase of average trophic level. Together with
connectance, it suggests that community biomass losses and gains are associated
to losses and gains in large bodied piscivores, i.e. biomass at the higher
trophic level. In the same line, we found that the temporal trends of community
biomass were positively associated to the temporal trends of both number and
proportion of piscivorous fish species present in the communities (Fig.
SXX). The close association between the temporal trends of community biomass
from one side, and connectance, average trophic level from the other side,
strongly suggest that temporal trends in community biomass in natural freshwater
fish communities are mainly associated to variations in the biomass of the top
trophic level.

In contrast, we found that temporal trends of connectance was weakly negatively
related to the temporal trends of species richness, in contrasts with the strong
negative relationships that we found in the present study and from previous
results over spatial gradient [@dunne_network_2006; @danet_species_nodate].
Furthermore, we found that temporal trends of the proportion of piscivorous
species was negatively associated to the temporal trends of species richness
(Table SXX), in accordance with previous meta-analysis over spatial gradient
[@turney_pyramids_2016] and mesocosm experiment [@downing_ecosystem_2002]. It
resonates with the energetic paradigm of food-webs which proposes that the
presence of species at higher trophic level is constrained by energy loss along
the food chain [@lindeman_trophic-dynamic_1942]. It suggests that the temporal
increase of species richness found in our dataset are associated to a decrease
of connectance because species richness increases are biased toward
non-piscivorous species which have less feeding links than piscivorous species.
We found in the same time that the temporal trends species richness had no
direct link with the temporal trends of the average trophic level, the latter
being weighted by the biomass of each node. An explanation can be that when
species richness increases or decreases through time without community biomass
trends, the associated decrease and respectively increase in proportion of
piscivorous species leads to a redistribution of biomass among remaining
piscivorous species or among the non-piscivorous species.

The temporal trends of species richness had an indirect positive effect on the
temporal trends of both connectance and average trophic level through the
positive relationship between the temporal trends of species richness and
community biomass. The temporal trends of species richness had then an
total effect on the temporal trends of connectance and average trophic level
which was twice lower in magnitude than the magnitude of the total effect of the
temporal trends of community biomass. It suggests that the temporal assembly and
disassembly of food-webs are more sensible to variations in community biomass
than in species richness, in other words that food-web structure is more robust
to species richness change than biomass changes. This result is in line with
evidences that food-web containing generalist predators can rewire in response
to changes in the availability of prey species [@bartley_food_2019]. *(J'ai
regardé dans la biblio envoyé par Elisa et j'ai refais de la biblio moi-même, je
n'ai rien qui s'approche de ce résultat).* This result also resonates with the
energy paradigm of food-webs which proposes that food-webs are primarily
constrained by fluxes of matter and energy [@lindeman_trophic-dynamic_1942], so
community biomass and not by species richness.
 

- Remove the following paragraph:  

As studies reported community biomass or species richness temporal trends
[@hallmann_more_2017; @ceballos_biological_2017; @dornelas_assemblage_2014;
@blowes_geography_2019], we document that temporal trends of species richness
and community biomass might have different consequences on the structure of the
community. In particular, the decrease of the average trophic level associated
to the loss of community biomass could have cascading effect on ecosystem
functioning as the highest predators are predicted to increase productivity and
stabilise communities [@wang_biodiversity_2018; @shanafelt_stability_2018;
@danet_species_nodate]. In contrasts, the loss of species richness might be
linked to loss of redundancy in the food-web, highlighting that those
communities may become more at risk regarding future perturbations
[@yachi_biodiversity_1999]. Interestingly, the hypothesis that temporal trends
in community biomass is related to higher trophic level in our system has a
strong reasoning with the effect of human fisheries in marine systems which
affect primarily fish species at top trophic level [@sprules_surfing_2016].
Overall, our study highlights that monitoring several facets of biodiversity is
essential to infer how ecological communities are reshaped by loss and gain of
biomass and species richness.


## Space-for-time substitution does not always hold

In time and space, we found that connectance was positively linked to community
biomass. This result is also in accordance with theoretical work showing that
higher food-web connectance can result in higher community biomass
[@thebault_food-web_2003], or lower [@poisot_trophic_2013], highlighting that
the relation between connectance and community biomass may be dependant on how
food-web structure change with community biomass. Likewise, we found that
average trophic level had a positive relationship with community biomass in
space and time, in accordance with a theoretical study predicting an increase of
community biomass subsequent to the presence of higher predators
[@wang_biodiversity_2018]. Finally, we found a positive relationship between
community biomass and species both in space and time, however the relationship
in time was stronger.

Surprisingly, we found that the temporal trends of connectance were weakly
related to the one of species richness as found spatially in most empirical
food-webs [@dunne_network_2006] and also here. We further found a weak negative
relationship between the temporal trends of average trophic level and the one of
species richness which we found a twice stronger but positive relationship
between median average trophic level and median species richness over the
spatial gradient. An explanation might be that environmental gradient, in
resources in hydrologic contraints might be responsible for the strong negative
effect of species richness on both connectance and average trophic level over
spatial gradient. However, we controlled our spatial analysis by the Biological
Demand in Oxygen, water temperature and the stream gradient. This result is also
in line with other studies which found mismatch between spatial and temporal
patterns [@adler_contrasting_2007; @johnson_testing_2008]. This discrepancy in
space and time might be due to the crucial assumption that variations in space
reflect differences in assembly stages of ecological communities and then
mirrors their temporal assembly/disassembly trajectories. Temporal variation of
species richness might relate on transitory dynamics while spatial gradient
reflect aggregated dynamics over longer time scale including a far number of
processes including high species turnover along spatial gradient. Another reason
might be that the spatial gradient displays a higher range of variation for
species richness than the temporal stations (Fig. S2). However, we found
temporal trends of species richness of -70%/-50% to +80%/+100% by decade.

- Développer un point la-dessus?:

Our study highlights that time series are an important tool to
understand the assembly and disassembly of food-webs following changes in
species richness and biomass. Our study also highlights the usefulness of
structural equation model to highlight direct and indirect pathways. 
  
---
### Biomass and richness gains and losses are symmetric processes in terms of community structure
#
#We found no case in which gain or losses of biomass and richness lead to
#different relationship between the temporal dynamic of community structure and
#the one of biomass and species richness. We could have imagined that
#extinction/colonisation processes or immigration/extinction debt could have lead
to different relationships.
---

## Conclusion and perspectives

Our study suggests that species richness and community biomass temporal trends
in natural fish communities relate on different ecological processes, biomass
temporal dynamics being related to variations of food-web structure at the
higher trophic levels while variations of species richness is weakly related to
change in food-web structure. Our result also suggests that space for time
substitution may be relevant to predict the effects of community biomass losses
or gains on food-web structure. However, our findings suggest that
space-for-time substitution might not work for species richness. Our study calls
for further investigations to support the generality of assembly rules in
food-webs. They are crucial to better understand the assembly and disassembly of
food-web and then predict its impact on ecosystem functioning.

# References  {-}

<div id="refs"></div>

\newpage





