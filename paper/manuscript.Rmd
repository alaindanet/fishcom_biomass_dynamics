---
title: "Community biomass and species richness temporal trends reveal contrasting assembly and disassembly processes in natural food-webs"
author: Alain Danet (a), Loubna El Madouri (a, c), Maud Mouchet (a), Elisa Thébault (d) and Colin Fontaine (a)
date: Research report
output:
  #bookdown::word_document2:
  #  fontsize: 12pt
  bookdown::pdf_document2:
    fig_caption: true
    keep_tex: true
    toc: false
    fontsize: 12pt
header-includes:
   - \usepackage{natbib}
   - \usepackage{float}
   - \usepackage{multirow}
   - \usepackage{booktabs}
   - \usepackage{makecell}
   - \usepackage{setspace}
   - \doublespacing
   - \usepackage{lineno}
   - \linenumbers
geometry: margin=2cm
number_sections: true
bibliography: references.bib
csl: pnas.csl
---

```{r, echo = FALSE}
knitr::opts_chunk$set(
  cache = FALSE,
  collapse = TRUE,
  comment = "#>",
  #fig.dim = c(7, 7),
  fig.fullwidth = TRUE,
  fig.show = "hold",
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  results = TRUE,
  fig.path="figures/"
)
options(
  knitr.table.format = "latex",
  knitr.graphics.rel_path = FALSE
)
```

```{r, results = FALSE}
library(targets)
library(tidyverse)
library(magrittr)
library(cowplot)
library(viridis)
library(kableExtra)
library(sf)
mypath <- rprojroot::find_package_root_file
source(mypath("R/variable_shortcut.R"))
source(mypath("R/misc.R"))
source_dir(get_mypath("R")) # Define your custom code as a bunch of functions.

mytheme <- theme_cowplot() +
background_grid()

theme_set(mytheme)
```

```{r}
tar_load(full_data2)
nb_st <- unique(full_data2$station) %>% length
nb_op <- nrow(full_data2) %>% round(., -3)

rm(full_data2)
tar_load(glob_tps_trends_decade_no_drivers)
```

- Corresponding author: Alain Danet (a.h.danet@sheffield.ac.uk)

- Author affiliations:

(a) Centre d’Ecologie et des Sciences de la Conservation, UMR 7204 MNHN7
CNRS-Sorbonne Université, Muséum national d’Histoire naturelle de Paris, 43 rue
8 Buffon, 75005 Paris, France

(b) Department of Biosciences, Alfred Denny Building, University of Sheffield,
Western Bank, Sheffield S10 2TN, United Kingdom

(c) ?

(d) Sorbonne Université, CNRS, IRD, INRAE, Université Paris Est Créteil, 15
Institute of Ecology and Environmental Sciences of Paris (iEES-Paris), Paris,
France

- Classification: Biological Sciences (major) - Ecology (minor)

- Keywords: food-web, biodiversity changes, assembly rules, space-for-time

# Abstract (240 / 250 words max)

Understanding food-web assembly processes is central to biological conservation
and maintenance of ecosystem functions. In particular, temporal changes in
community biomass and species richness are expected to significantly impact
food-web structure but empirical assessments are lacking so far. Here, we
investigate how temporal trends in species richness and community biomass affect
temporal trends in food-web structure. To do so, we used more than 6000 sampled
riverine fish community in 400 sites from french monitoring data. We inferred
food-web structure for each sampling event, using diet data and body size. Using
structural equation models, we estimated the effects of temporal changes in
community biomass and species richness on temporal changes in food-web
structure. We found that a positive effect of temporal trends in community
biomass on the temporal trends of connectance and average trophic level, a
result also found using spatial variations and a bioenergetic model. Temporal
trends in species richness had a positive effect on average trophic level, but
no effects on connectance. In space and in simulations, species richness had in
contrast a negative effect on average trophic level and connectance. In sum, our
study highlight that local temporal changes in biomass and species richness have
contrasting effects on food-web structure. It further reveals that temporal
changes and spatial variations in biomass lead to coherent food-web assembly
patterns, in contrast to species richness. Our study sheds a new light on
food-web assembly in natural settings.

# Significance (115 / 120 words max)

While the multidimensional nature of biodiversity changes has been clearly
emphasized, little is known on how the structure of food-web changes according to
changes in species richness and community biomass. By inferring food-web
structure based on food-diet data and body size ratios, we analyzed how food-web
structure in time according to concomitant changes in species richness and
community biomass. We identify that community biomass is the primary driver of
temporal changes in food-web structure, but that species richness has surprisingly
low effect. We further show that space-for-time leads to contrasting results for
species richness. Our results shed a new light on the assembly and disassembly
of food-web according to changes in biomass and in species richness.

# Introduction (487 words)

Understanding how biodiversity changes is a central question in ecology,
although challenging because biodiversity changes are multidimensional
[@mcgill_fifteen_2015; @blowes_geography_2019; @hillebrand_biodiversity_2018],
such as important changes in species composition can happen despite no changes
in species richness in average [@dornelas_assemblage_2014;
@blowes_geography_2019]. Yet species interactions are largely absent from
biodiversity changes. Although species interactions, described as ecological
networks, drive for a large part community composition, species coexistence, and
ecosystem functioning [@chesson_mechanisms_2000; @thebault_food-web_2003;
@oconnor_general_2017]. The structure of ecological networks can trigger or
impede perturbation propagations, i.e. secondary extinctions [@paine_note_1969;
@dunne_network_2002; @srinivasan_response_2007;
@stouffer_compartmentalization_2011]. Higher connectance, which measures the
degree of generalism in a network, is predicted to increase robustness to
secondary extinctions [@dunne_network_2002; @sole_complexity_2001] and studies
found that the presence of higher trophic levels is associated to a higher temporal stability of
community biomass in theoretical models and empirical data
[@shanafelt_stability_2018; @danet_species_2021]. Then, accounting for how the
structure of ecological networks changes over time according to other
biodiversity facets is crucial to understand biodiversity changes.

The availability of ecological network timeseries is scarce
[@kortsch_disentangling_2021], such as predictions about how the structure of
ecological networks change according to changes in species richness come from
spatial comparison of networks. Such studies showed that connectance is
negatively related to species richness in food-webs [reviewed in
@dunne_network_2006; @danet_species_2021], which reflects constraints on the
number of realizable species interactions or an increasing proportion of
specialists in more rich food-webs. Connectance has been shown to scale
positively or negatively with community biomass in theoretical food-webs
[@thebault_food-web_2003; @poisot_trophic_2013] while the average trophic level
was previously shown to scale negatively with species richness in empirical
food-webs [@danet_species_2021].

However, predicting how ecological networks will change in time according to
other biodiversity facets based on spatial comparison of food-webs
is valid if the assumption of space-for-time substitution is as
well. Space-for-time substitution supposes a homology between variations in
space and in time, i.e. that spatial sequences correspond to temporal sequences.
This method raised criticisms [@damgaard_critique_2019], with studies
showing analogous patterns in space and time [@blois_space_2013] or not
[@johnson_testing_2008; @adler_contrasting_2007]. Spatial turnover of species
composition, dispersal limitation, disturbance and stochastic processes have
been hypothesized to be responsible for the non-compliance of space-for-time
substitution [@adler_contrasting_2007; @blois_space_2013].

The increasing availability ecological temporal series and the development of
methods to reconstruct food-webs [@bonnaffe_comparison_2021;
@gravel_inferring_2013; @danet_species_2021] makes possible to overcome those
research gaps. We used a standardized monitoring of fish riverine communities on
the period 1995-2018 over France, documenting the individual size of fishes in
`r nb_st` sites during ten years or more. We reconstructed around `r nb_op`
food-webs based on allometric relationships and food diet data, and then
computed connectance, and average trophic level as well as community biomass and
species richness. We assessed how the local structure of food-webs changes over
time according to simultaneous changes in community biomass and species richness
over time and then if the relationships between changes in food-web structure,
community biomass and species richness, are the same over space and over time,
i.e. is the space-for-time substitution valid?

*Introduce hypothesis and the food-web metrics (connectance and average trophic
level)*

# Results

```{r, results=FALSE}
gbm <- get_effect_ci(resp = "log_bm_std", ci_lvl = "level:0.80", p = TRUE)
gr <- get_effect_ci(resp = "log_rich_std", ci_lvl = "level:0.80", p = TRUE)
gt <- get_effect_ci(resp = "w_trph_lvl_avg", ci_lvl = "level:0.80", p = FALSE)
gct <- get_effect_ci(resp = "connectance", ci_lvl = "level:0.80", p = FALSE)
gl <- get_effect_ci(resp = "prop_redundant_links", ci_lvl = "level:0.80", p = FALSE)
```

```{r}
tar_load(c(r2_inla_tab, r2_inla, r2_sem))
r2_inla_report <- r2_inla %>%
  select(response, r2_mvp_marg95hpdci, r2_mvp_cond95hpdci, r2_mvp_cond_mean)
r2cond <- map(
  setNames(r2_inla_report$response, r2_inla_report$response),
  ~round(r2_inla_report[r2_inla_report$response == .x, ]$r2_mvp_cond_mean, 2)
)
r2ic <- map(
  setNames(r2_inla_report$response, r2_inla_report$response),
  ~r2_inla_report[r2_inla_report$response == .x, ]$r2_mvp_cond95hpdci
)
```

```{r}
tar_load(summary_pred_station_tps10)
dfv <- function(
  x = summary_pred_station_tps10,
  r = "connectance",
  v = "min",
  d = 4
) {
  out <- x[x$response == r, ][[v]]
  format(round(out, d), nsmall = d)
}
grbmn <- dfv(r = "log_bm_std", v = "min", d = 0)
grbmx <- dfv(r = "log_bm_std", v = "max", d = 0)
grrhn <- dfv(r = "log_rich_std", v = "min", d = 0)
grrhx <- dfv(r = "log_rich_std", v = "max", d = 0)
grctn <- dfv(r = "connectance", v = "min", d = 2)
grctx <- dfv(r = "connectance", v = "max", d = 2)
grtln <- dfv(r = "w_trph_lvl_avg", v = "min", d = 2)
grtlx <- dfv(r = "w_trph_lvl_avg", v = "max", d = 2)
grln <- dfv(r = "prop_redundant_links", v = "min", d = 2)
grlx <- dfv(r = "prop_redundant_links", v = "max", d = 2)
```

Using a Bayesian hierarchical model to jointly estimate the temporal trends of
food-web structure at all sites, we found weak evidence of an overall decrease
in community biomass (CI80%:`r gbm` by decade; median [Credible Interval], Fig.
S1) but no evidence of an overall temporal increase in species richness
(CI80%: `r gr` by decade) across the `r nb_st` sites. We did not find evidence
of average temporal trends in connectance and average trophic level (CI80%:
`r gct` and `r gt` respectively), but an increase in redundancy (measured by the
proportion of redundant links, CI80%: `r gl`). However, we found a great
heterogeneity in the temporal trends estimated at the site level (community
biomass: from `r grbmn`% to `r grbmx`% per decade, species richness: `r grrhn`
to +`r grrhx`%, average trophic level: `r grtln` to +`r grtlx`, connectance:
`r grctn` to +`r grctx`, redundancy: `r grln` to +`r grlx`, Fig. S1) which was
well captured by the hierarchical model with conditional R2 going from
`r r2cond$log_bm_std` for community biomass to `r r2cond$log_rich_std` for
species richness (Table S1).


```{r}
sem_cap <- "(a) Structural equation models linking the temporal trends of the food-web
structure. The path widths are proportional to the standardized slope
coefficients. The standardized slope coefficients and their associated 95%
confidence intervals obtained by bootstrapping are displayed along the path. The
marginal R-squared of the linear models are displayed. (b to f) Direct bivariate
relationships derived from the structural equation model. The distribution of
the site temporal trends are displayed in Fig. S1. All the effects are reported
in Table S4."
```

```{r sem, fig.cap = sem_cap}
knitr::include_graphics(here::here("figures", "fig2.pdf"))
```

```{r}
tar_load(c(semeff_tot, semeff_tot_ok))
semeff_tot <- semeff_tot %>%
  mutate(across(c(response, predictor), ~str_remove(.x, "mean_")))

rdtps <- map(
  setNames(
    c("connectance", "w_trph_lvl_avg", "log_bm_std", "prop_redundant_links"),
    c("ct", "tlvl", "bm", "red")
    ),
  ~ list(
    bm = get_semeff_ci(resp = .x, term = "log_bm_std"),
    r = get_semeff_ci(resp = .x, term = "log_rich_std")
    )
)
rdsp <- map(
  setNames(
    c("connectance", "w_trph_lvl_avg", "log_bm_std", "prop_redundant_links"),
    c("ct", "tlvl", "bm", "red")
    ),
  ~ list(
    bm = get_semeff_ci(resp = .x, term = "log_bm_std", model = "spatial"),
    r = get_semeff_ci(resp = .x, term = "log_rich_std", model = "spatial")
    )
)
rdm <- map(
  setNames(
    c("Connectance", "Avg trophic level", "Biomass", "Redundancy"),
    c("ct", "tlvl", "bm", "red")
    ),
  ~ list(
    bm = get_semeff_ci(x = semeff_tot_ok, type = "Direct", resp = .x, term = "Biomass", model = "Theoretical model"),
    r = get_semeff_ci(x = semeff_tot_ok, type = "Direct", resp = .x, term = "Species richness", model = "Theoretical model")
    )
)
```

```{r}
ridtps <- map(
  setNames(
    c("connectance", "w_trph_lvl_avg", "log_bm_std", "prop_redundant_links"),
    c("ct", "tlvl", "bm", "red")
    ),
  ~ list(
    r = get_semeff_ci(resp = .x, term = "log_rich_std", type = "indirect")
    )
)
ridsp <- map(
  setNames(
    c("connectance", "w_trph_lvl_avg", "log_bm_std", "prop_redundant_links"),
    c("ct", "tlvl", "bm", "red")
    ),
  ~ list(
    r = get_semeff_ci(resp = .x, term = "log_rich_std",
      model = "spatial", type = "indirect")
    )
)
ridm <- map(
  setNames(
    c("Connectance", "Avg trophic level", "Biomass", "Redundancy"),
    c("ct", "tlvl", "bm", "red")
    ),
  ~ list(
    bm = get_semeff_ci(x = semeff_tot_ok, type = "Indirect", resp = .x, term = "Biomass", model = "Theoretical model"),
    r = get_semeff_ci(x = semeff_tot_ok, type = "Indirect", resp = .x, term = "Species richness", model = "Theoretical model")
    )
)
rttps <- map(
  setNames(
    c("connectance", "w_trph_lvl_avg", "log_bm_std", "prop_redundant_links"),
    c("ct", "tlvl", "bm", "red")
    ),
  ~ list(
    bm = get_semeff_ci(resp = .x, term = "log_bm_std", type = "total"),
    r = get_semeff_ci(resp = .x, term = "log_rich_std", type = "total")
    )
)
rtsp <- map(
  setNames(
    c("connectance", "w_trph_lvl_avg", "log_bm_std", "prop_redundant_links"),
    c("ct", "tlvl", "bm", "red")
    ),
  ~ list(
    bm = get_semeff_ci(resp = .x, term = "log_bm_std",
      model = "spatial", type = "total"),
    r = get_semeff_ci(resp = .x, term = "log_rich_std",
      model = "spatial", type = "total")
    )
)
rtm <- map(
  setNames(
    c("Connectance", "Avg trophic level", "Biomass", "Redundancy"),
    c("ct", "tlvl", "bm", "red")
    ),
  ~ list(
    bm = get_semeff_ci(x = semeff_tot_ok, type = "Total", resp = .x, term = "Biomass", model = "Theoretical model"),
    r = get_semeff_ci(x = semeff_tot_ok, type = "Total", resp = .x, term = "Species richness", model = "Theoretical model")
    )
)
```

Using structural equation models to disentangle the direct and indirect effects
of temporal trends in fish species richness and community biomass on temporal
trends in food-web structure, we found a strong positive effect of the temporal
trends in species richness on community biomass ($r_\delta =$ `r rdtps$bm$r`,
Fig. \@ref(fig:sem) a and b, $r_\delta$: standardized slope coefficient, [95%
CI]), meaning that both temporal trends had the same direction in average. In
other word, food-webs that have experienced a decrease in species richness over
time have decreased in community biomass, and conversely, those that increased
in species richness have increased in community biomass.
Temporal trends in community biomass had in turn a positive effect on connectance,
average trophic level, and redundancy (resp. $r_\delta =$ `r rdtps$ct$bm`,
`r rdtps$tlvl$bm`, `r rdtps$red$bm`, Fig. \@ref(fig:sem)b, c, d), meaning that
food-web whose community biomass decreased over time have decreased in
connectance, average trophic level and redundancy, and
conversely, those that have experienced an increase in biomass have increased in
connectance, average trophic level and redundancy. We further found that the temporal
trends of community biomass were positively associated to the temporal trends of
both number and proportion of piscivorous species present (Fig. S3a), meaning
biomass trends are linked to the presence of high trophic level trophic
species.

We further tested if we find the same patterns using spatial variations in
food-web structure rather than temporal changes over time, i.e. if the
space-for-time hypothesis hold. To do so, we used the same dataset and same
structural equation model but with the median food-web structure per site
instead of the temporal trends. We additionally performed theoretical
simulations with a bioenergetic food-web model to further get theoretical
expectations about how food-web structure changes according to community biomass and
species richness variations (see Methods). As in temporal data, species richness
had a positive effect on community biomass both in empirical data and in
theoretical simulations (resp. $r_\delta =$ `r rdsp$bm$r` and `r rdm$bm$r`, Fig.
\@ref(fig:std) and S5). In both empirical data and theoretical simulations, community
biomass had a positive effect average trophic level (resp.
$r_\delta =$ `r rdsp$tlvl$bm` and `r rdm$tlvl$bm`), and redundancy (resp.
$r_\delta =$ `r rdsp$red$bm` and `r rdm$red$bm`), as in temporal analysis.
We found weak evidence of a positive effect of spatial variation in community
biomass on connectance in empirical data ($r_\delta =$ `r rdsp$ct$bm`) but
strong evidence in theoretical simulation ($r_\delta =$ `r rdm$ct$bm`, Fig. \@ref(fig:std)).

The effects of species richness were more complex, because species richness had
indirect effects on food-web structure through community biomass. Temporal
trends in species richness had a direct negative effect on connectance
($r_\delta =$ `r rdtps$ct$r`, Fig. \@ref(fig:sem)f), a positive
indirect effect through community biomass ($r_\delta =$ `r ridtps$ct$r`), so
that species richness temporal trends had a negative effect in total on temporal in
connectance ($r_\delta =$ `r rttps$ct$r`, Fig. \@ref(fig:std)).
In contrast, temporal trends in species had no direct effects on the temporal
trends in average trophic level ($r_\delta =$ `r rdtps$tlvl$r`, Fig.
\@ref(fig:sem)g), a positive indirect effect through community
biomass ($r_\delta =$ `r ridtps$tlvl$r`), which adds up to a positive total
effect of species richness temporal trends on average trophic level ($r_\delta
=$ `r rttps$tlvl$r`, Fig. \@ref(fig:std)). Species richness temporal trends had
direct and indirect positive effect on the temporal trends in redundancy (resp.
$r_\delta =$ `r rdtps$red$r`, `r ridtps$red$r`), which added up to a strong
positive effect ($r_\delta =$ `r rttps$red$r`). Furthermore, we found that
temporal trends of the proportion of piscivorous species was negatively
associated with the temporal trends of species richness (Fig. S3), meaning that
communities that increase in richness over time have an increase in the
proportion of non-piscivorous species over time and vice versa. It means
food-webs that have experienced declines in species richness over the last
decades have decreased in average trophic level and redundancy but increase in
connectance, and conversely, those that experienced increases in species
richness have increased in average trophic level, redundancy, but decreased in
connectance.

The effects of spatial variations in species richness on food-web structure
mostly agreed with the ones found with temporal trends, expect for average
trophic level. We found a direct negative effect of species richness on
connectance both using data and model simulations
(resp. $r_\delta =$ `r rdsp$ct$r` and `r rdm$ct$r`, Fig. \@ref(fig:std)), on
average trophic level (resp. $r_\delta =$ `r rdsp$tlvl$r` and `r rdm$tlvl$r`),
but a direct positive effect on redundancy (resp. $r_\delta =$ `r rdsp$red$r`
and `r rdm$red$r`). Species richness had indirect positive effect of species
richness through community biomass, which added up to strong total negative
effects on connectance in empirical data and simulations (resp. $r_\delta =$
`r rtsp$ct$r` and `r rtm$ct$r` ) and positive on redundancy (resp. $r_\delta =$
`r rtsp$red$r` and `r rtm$red$r`). We found that species richness had a total
positive effect on average trophic level in bioenergetic model, in agreement
with temporal trends (resp. $r_\delta =$ `r rtm$tlvl$r`), but a total negative
effect in spatial variations (resp. $r_\delta =$ `r rtsp$tlvl$r`).

We performed extinction simulations scenario on the metaweb, the food-web
including all the species and nodes found in the empirical data, to better
understand how species richness change affect food-web structure. When species
are removed in a sequential order beginning by the highest trophic levels,
connectance and average trophic level decreased as we removed species (red
lines, Fig. S2a). At the opposite, removing first low trophic level species first
increase connectance and average trophic level (green lines, Fig. S2a). In turn,
random species extinction sequence had little effect on food-web structure
(black lines, Fig. S2a).


```{r}
std_cap <- paste0(
  "Direct and total effects of community biomass and species richness.
  Standardized coefficients ($r_\\delta$) derived from the temporal, spatial,
  and bioenergetic model Structural Equation Models. Points and lines display
  the estimated effects and their confidence intervals at 95\\%. Values are
  displayed in Table SXX, R-squared in Table SXX, and the visualisation of the
  bivariate relationships for the spatial and bioenergetic model SEMs are
  displayed in Figure SXX.")

```

```{r std, fig.cap=std_cap, fig.width=7, fig.asp = .7}
knitr::include_graphics(here::here("figures", "p_sem_tps_sp.pdf"))
```


# Discussion

We found remarkable heterogeneity in community biomass and species richness
changes over the last decades in riverine fish communities, linked to changes in
food-web structure. Community biomass changes spanned from -`r grbmn`% to `r
grbmx`% per decade, species richness from `r grrhn`% to +`r grrhx`% per decade,
in line previous reports of the heterogeneity of local biodiversity changes in
terrestrial, marine and freshwater realms[@dornelas_assemblage_2014;
@blowes_geography_2019; @danet_past_2024]. In turn, connectance temporal changes
spanned from `r grctn` to +`r grctx` per decade, average trophic level, from
`r grtln` to +`r grtlx` per decade and the proportion of redundant trophic links
from `r grln` to +`r grlx` per decades. We questioned the effects of community
biomass and species richness changes over time on temporal changes in food-web
structure, that we also tested across space and with simulations using a
bioenergetic food-web model. We found positive effects of species richness
changes on changes in community biomass that were consistent across temporal and
spatial analysis and with the theoretical model. The effects of community
biomass changes on food-web structure were also consistent across analysis,
suggesting that loss of community biomass are linked to the loss of the trophic
species of high trophic level. However, changes in species richness had
contrasting effects on food-web structure depending on the type of analysis,
temporal or spatial and theoretical simulations. It suggests that food-web
structural changes induced by changes in species richness differs from the one
induced by the changes in community biomass, and that they imply different
processes across time and space. However, all analysis converged to indicate
that community biomass and species richness declines trigger a decrease in
food-web redundancy. In what follows, we discuss how changes in community
biomass and species richness changes over time and space are related to food-web
assembly and disassembly processes.

We found that species richness scaled positively with community biomass, both in
temporal, spatial and theoretical simulations, in accordance with previous
analysis across space in stream communities [@woods_testing_2020;
@danet_species_2021] but also in grasslands, salt marches and forests
[@hector_plant_1999; @tilman_biodiversity_2014; @wu_relationship_2015;
@li_relationship_2018; but see @grace_integrative_2016]. This results is in
agreement with previous findings showing that food-web diversity can increase
biomass by stimulating primary production and resource uptake
[@wang_biodiversity_2018]. Our results suggest that food-web losing species
richness over time also experience a loss of biomass, while those gaining
species experience a increase in community biomass. This results is coherent the
Biodiversity-Ecosystem Functioning theory [@loreau_biodiversity_2001;
@wang_biodiversity_2018], and suggest that the loss of species richness and
biomass might impair ecosystem functioning.

Our results suggest that food-web that have undergone a biomass decline
experienced a loss of top trophic levels species and connectance, those gaining
biomass experienced a gain in top trophic levels and connectance. Importantly,
the same results were found using spatial comparison and theoretical models.
This results can be linked with the energetic and trophic biogeography theories
[@lindeman_trophic-dynamic_1942; @gravel_trophic_2011], which posits that the
presence of top predators is limited by the amount of energy and resource
available [@lindeman_trophic-dynamic_1942, @takimoto_ecosystem_2008;
@post_ecosystem_2000; @post_long_2002]. Thereby, a decrease in community biomass
can limit the amount of resource available to sustain top predators, while
increase in community biomass may result in more resource available for top
predators [@takimoto_ecosystem_2008; @post_ecosystem_2000].

Species richness temporal changes were positively associated to changes in
average trophic level through community biomass and in connectance mainly
through direct effects, such as food-webs that have suffered a decline in
species richness over last decades have experienced a concomitant decline in
average trophic level and increase in connectance, those have seen an increase
in species richness have experienced an increase in average trophic level and
decline in connectance. However, the effect of species richness temporal trends
on average trophic level were twice lower than the one of community biomass.
Altogether, it suggests that species richness increase and decrease were less
clearly linked to specific changes in top trophic levels than community biomass.
Species richness temporal trends could be more linked to changes in the
redundancy of trophic roles in the food-webs, such as it has little effects of
food-web structure but increases its community biomass. This interpretation
align with the insurance hypothesis [@yachi_biodiversity_1999;
@loreau_biodiversity_2021], such as species richness and associated redundancy
in species roles can increase ecosystem stability by buffering the impacts of
perturbations [@sanders_trophic_2018].

When considering spatial analysis and model simulations, species richness
effects on food-web structure mostly consistent from the temporal analysis. All
analysis converged to indicate that increases in species richness result in
decreases in connectance, a well documented pattern in empirical food-webs
[@dunne_network_2006; @danet_species_2021]. However, spatial analysis found that
species richness decrease average trophic level, while temporal analysis and
theoretical models found that species richness increases result in higher
average trophic level. This result is also in line with other studies which
found a mismatch between spatial and temporal trends [@adler_contrasting_2007;
@johnson_testing_2008]. This discrepancy in space and time is due to the strong
assumption that variations in space reflect differences in assembly stages of
ecological communities and then mirror their temporal assembly/disassembly
trajectories. Temporal changes in species richness might relate to short-term
dynamics while spatial gradients reflect aggregated dynamics over a longer time
scale including a far number of processes including high species turnover along
spatial gradients. Our results then suggest community biomass changes in space
might be a good surrogate to infer assembly and disassembly of food-web in time,
but that it is probably not always the case for species richness.

Our study demonstrates that redundancy of trophic pathways in food-webs are
positively associated to both community biomass and species richness changes, so
as declines in community biomass and species richness triggers a loss in the
proportion of redundant links in food-webs, while increases in community biomass
and species richness over time results in the increase in the proportion of
redundant links in food-webs. Redundant links are the trophic links that can be
removed with triggering secondary extinctions [@allesina_who_2004;
@bodini_using_2009], such an higher proportion of redundant interactions
increase robustness of food-webs to perturbations [@allesina_functional_2009].
It suggests that declines in community biomass and species richness result in a
decline of food-web robustness to further perturbations.


Our study brings evidences that temporal changes in community biomass and
species richness are related to changes in food-web structure in empirical
settings. We completed the temporal analysis with a spatial analysis and
theoretical simulations. Altogether, it suggests that community biomass changes
are associated with changes in the presence of top predators, in agreement with
the hypothesis that food-web maximum trophic level are limited by the amount of
energy available in lower trophic level. In contrast, species richness changes
seems to be linked to changes in upper and lower part of the food-webs.
Importantly, temporal and spatial analysis using empirical fish food-webs are
largely in agreement with theoretical simulations, which highlight the potential
generality of the food-web assembly rules that we report. The study finally
highlights that increases in community biomass and species brings robustness to
food-webs by increasing the proportion of redundant trophic links. Conversely, it
suggests that community declines in species richness and community biomass are
likely to decrease significantly the community robustness to further
perturbations. Thereby, the numerous reported declines in biodiversity might
hide increase in the fragility of ecosystems.

# Material & Methods

We used a monitoring of freshwater fishes conducted all over France and
conducted by the Office Français de la Biodiversité (OFB, previously known as
ONEMA and AFB). The sampling protocols were standardized since 1995 and a
complete description of the sampling process can be found in
@danet_species_2021 (main text and appendix S2). The fishes are sampled using
electrofishing all across the streams in shallow streams and over the bank by
boat in deeper streams. All the fishes are counted and the bodysize of fishes are
recorded for a sample of them, enabling the estimate the distribution of
individual bodysize by species for each sampling [@bonnaffe_comparison_2021;
@danet_species_2021].

We selected the sites that have been monitored at least 10 years on the
1995-2018 period, with the same sampling protocol over time. We selected
one sampling a year by site. In each site, we ensured low temporal heterogeneity
in sampling period by selecting sampling that were performed in the same period,
leading to a mean standard deviation of sampled month in each site of three
weeks [@danet_species_2021]. Those steps leads to the selection of
`r nb_st` sites (Fig. \@ref(fig:matmet), Table S2).

## Biomass

We first inferred the body mass of each fish individual considering an allometric
law, $B_i = 0.01 \times l_i^{3.03}$, $B_i$ being the biomass expressed in gram and $l_i$ the
body length of the individual $i$ expressed in millimeters [@froese_cube_2006]. Then the
biomass of each species and community biomass were obtained by summing the body
mass of individuals. Finally, the biomass was reported to the sampled surface
(in $m^2$) to account for sampling effort.

## Food-web inference

We inferred food-web structure in two steps [@bonnaffe_comparison_2021;
@danet_species_2021]: (1) we first computed the metaweb, describing the
potential trophic interactions among all size classes species, (2) then we
extracted each yearly snapshot of food-webs by extracting species size classes
and their interactions according to their presence in a given sampling event.

We inferred the metaweb according to ontogenic diet data and body size
[@gravel_inferring_2013; @poisot_structure_2016; @brose_predator_2019;
@bonnaffe_comparison_2021; @danet_species_2021]. The method is extensively
described in @bonnaffe_comparison_2021 and @danet_species_2021. The food diet of
stream fishes changes along their life cycle or stage, therefore according to
their body size. Each fish species was divided in nine size classes, named
"trophic species", equally distributed in their observed body size range. Thus,
a trophic species is a group of individuals of the same species and size class
that are expected to share the same preys and predators because trophic
interactions are largely determined by predator-prey size ratio
[@brose_allometric_2006]. We also added seven nodes present in the ontogenic
food diet database: detritus, biofilm, phytoplankton, zooplankton, macrophages,
phytobenthos and zoobenthos.  The resulting metaweb contained 45 fish species
divided into nine size classes plus 7 resource nodes, summing up to 412 nodes.
Consideration of size classes, i.e.  trophic species instead of species,
improves inference of trophic interactions [@jennings_weak_2001].

We determined the feeding interactions of trophic species according to their
species identity and their body size. The diet database described two or three
life stages by fish species, each one being delimited by body size. The
ontogenic fish diet database was filled according to fishbase
[@froese_fishbase_2021] and literature [@bonnaffe_comparison_2021;
@danet_species_2021].

The feeding interactions among fishes were based on the body size ratio
between predators and preys. We defined the predation window of a
piscivorous trophic species as 3% to 45% of its midpoint
[@mittelbach_ontogeny_1998; @claessen_impact_2002; @hart_handbook_2008].  A
trophic link was defined between the piscivorous trophic species and all the
trophic species whose midpoint in body size range was included in the predation
window.  The fish-resource trophic links were set between the trophic species
and the resources nodes according to the food items of their size class.
Finally, the feeding interactions between resources were defined according to the
literature [@allan_stream_2007; @hart_handbook_2008].

## Community and food-web structure

At each site, yearly food-webs were described by their community biomass and
species richness. Yearly food-web structure was described by their connectance,
describing the degree of generalism in a network [@dunne_network_2006;
@delmas_analysing_2019]. It was computed as the ratio between the number of
actual links and the number of potential links ($C = \frac{L}{S(S-1)}$, with $L$
being the number of links and $S$ the number of trophic species). We also
computed the average trophic level, weighted by the biomass of the trophic
species. The trophic level of a trophic species was computed recursively as 1
added to the mean trophic level of the preys that it consumes
[@herendeen_ecological_2008]. We computed the number of redundant and functional
links using the dominator tree approach [@allesina_functional_2009]. A species
$i$ is a dominator of species $j$ if $i$ mediates the connection $j$ to basal
resources such as the extinction of $i$ remove the connection of $j$ to basal
resources. It is then to identify the set of trophic links that are essential to
connect species to basal resources, i.e. functional links, and the
redundant links. This method requires a single basal root in the food-webs. To
do so, we added a basal dummy resource node to the empirical food-webs connected
to biofilm and phytoplankton resource node. For food-webs generated from
theoretical simulations (see below), we added a resource node connected to all
primary producers. We computed the set of dominator trees using the
`dominator_tree()` function in `igraph` R package. We computed the number of
functional links as the number of links in the resulting dominator tree of the
food-web. We checked that the procedure reproduced the examples presented in
@allesina_functional_2009. We then derived the proportion of redundant links in
food-webs of empirical and theoretical simulations.


## Temporal trends of food-web

We modeled the temporal trends of food-web structure at each site ($Y_i$) using
linear hierarchical model. Time was considered as the number of year since the
first sampling ($t = 0$) at each site. We accounted for the spatial structure of
the data by adding random intercepts ($a$) and slopes ($b$) for the
basin ($a_n$, $b_n$) and site ($a_{i|n}$, $b_{i|n}$) identity, site effects
being nested in the basin one.

$$
\begin{aligned}
    Y_{i|n, t} &= \alpha + \beta Time_t + \epsilon_{i|n, t}
  (\#eq:gen)
\end{aligned}
$$

- $\alpha = \alpha_0 + a_n + a_{i|n}$
- $\beta = \mu + b_n + b_{i|n}$
- $a_n, a_{i|n}, b_n, b_{i|n}, \epsilon_{i|n, t} \sim \mathcal{N}(0,\,\sigma^{2})$
- $n$: basin, $i$: site $i$, $t$: time $t$

The model parameters were estimated using INLA (Integrated Nested Laplacian
Approximation) Bayesian inference with default uninformative priors
[@rue_bayesian_2017]. The prior distributions for the fixed intercept and slope were
modeled as a flat normal distribution with a mean of zero ($\mathcal{N}(0,\, 1000)$).
Prior distributions for the Gaussian error $\epsilon_{i|n, t}$ and the random
effects were modelled as a log gamma distribution with
shape and inverse scale parameters ($\mathcal{G}(s, \, \tau) = \mathcal{G}(1, \,
5.10^-5)$), then their respective standard deviation were obtained by
backtransforming the inverse scale parameter ($\sigma = 1 / \sqrt{\tau}$).
Community biomass and species richness were logged transformed.

The performance of the model was assessed visually by plotting the fitted versus
the observed values (Fig. S4). We also visually inspected the Posterior
Integral Transform (PIT) and Conditional Predictive Ordinate (CPO) to assess the
quality of the model fit. We also computed the marginal ($R^2_m$)and conditional
($R^2_c$) R-squared of the models following previous formulations
[@nakagawa_general_2013; @lahuis_explained_2014]. In order to account for the
variability associated with the priors [@gelman_r-squared_2019], we computed the
variance of the posterior distribution  of each predicted values ($Var_{fit} =
\sigma^2(\hat{Y_i})$). We computed $R^2$ values for each predicted values, then
obtaining a $R^2$ distribution [@gelman_r-squared_2019]. We reported mean
marginal and conditional $R^2$ associated the 95% credible interval computed
using the Highest Posterior Density method.

$$
R^2_m = \dfrac{Var_{fit}}{Var_{fit} + Var_{res}} = \dfrac{\sigma^2(\hat{Y_i})}{\sigma^2(\hat{Y_i}) + \sigma^2(Y_i - \hat{Y_i})}
$$

$$
R^2_c = \dfrac{Var_{fit} + (a_n)^2 + (a_{i|n})^2}{Var_{fit}  + (a_n)^2 + (a_{i|n})^2 + Var_{res}}
$$

$y_i$ and $\hat{y_i}$ being respectively the observations and the
predicted values, $Var_{fit}$ and $Var_{res}$ being respectively the variance of
predictive means and the variance of the residuals. $a_n$ and $a_{i|n}$ are
respectively the standard deviation on the random intercept associated to the
basin and the site.

We extracted the temporal trends at each site from the hierarchical model
using mean BLUP values (Best Linear Unbiaised Prediction), then multiplied
by 10 to get temporal trends by decade. For logged transformed biomass and
species richness, we derived percentage change by decade by transforming the
slopes ($\beta\prime = (e^{\beta } - 1) \times 100 \times 10$).

## Spatial

We assessed the validity of the space-for-time substitution hypothesis by
comparing the relationships estimated among food-web structure in time to the
ones inferred in space. We used the same sites as in the temporal analysis,
but we summarised temporal series of each station by the median value over time
of each facet of food-web structure described above (Fig. \@ref(fig:matmet)).

## Statistical analysis

We modeled the relationships among food-web structure, that is
connectance, average trophic level, the proportion of redundant trophic links, and
community biomass ($dB$) and species richness ($dR$) with Structural Equation
Models. We modeled species
richness as related to community biomass and food-web structure. In
turn community biomass was related to food-web structure. We computed one
structural equation model to assess the relationships among the temporal trends
and one for the relationships over the spatial gradient, we added a random effect
of the hydrographic basin on the intercept for the latter one.

In order to control for the uncertainties of the estimated temporal trends, we
weighted each temporal trend by the inverse of the sum of the standard deviation
of the estimated trends, i.e. the estimated slopes for the response and the
explicative variables ($w_j = 1 / \sum{e_j}$, $w_j$ being the weight, and
$s_{e_j}$ the standard deviation on the temporal trends of the variables).

The coefficients of the Structural Equation Models were computed with
PiecewiseSEM R package [@lefcheck_piecewisesem_2016]. The coefficients were
standardized and the confidence intervals were computed with semEff R package
[@murphy_semeff_2021]. Confidence intervals were obtained by bootstrapping the
linear models 1000 times and computing adjusted bootstrap percentile interval
(BCa), which are adjusted for the asymmetric distribution of resampling. The marginal
and conditional $R^2$ associated to the linear models of the SEMs were computed
with the Nagelkerke method [@lefcheck_piecewisesem_2016, Fig. S5].

All the statistical models displayed low multicollinearity (Variance inflation
factors < 3, Table S4). We visually inspected the residuals of the linear
models.

```{r}
fig_mat_cap <- paste0("Using sites of stream fishes in French streams that
  have been monitored at least 10 years, 1) we infered the food-web at each site
and each sampling event based on ontogenic food diet information for each
species and predator-prey body size ratio. 2) We computed the temporal trends
and the median of community biomass, species richness, connectance, average
trophic level and evenness of biomass at each site. 3) We then assessed the
relationships among food-web structure descriptors, (a) in time and (b) across space.")
```


## Extinction simulation in the metaweb

We simulated extinction sequences in the metaweb according to three scenarios to
get expectations on how the food-web structure should change according to the
addition and deletion of species and nodes. The scenario of extinction sequences
were related to the trophic level of the species/nodes. In the decreasing and
increasing scenario, we removed species/nodes in decreasing, resp. increasing
order, of their trophic level, i.e. respectively beginning by the highest and
lowest trophic level. In the random extinction sequence, we built 50 random
extinction sequences. For each simulation, we removed fish species/nodes that
lost all their preys. We then computed the connectance, the average and the
maximum trophic level after each extinction.

## Theoretical simulations

```{r}
tar_load(sim_param)
nsim <- nrow(sim_param)
nfw <- length(unique(sim_param$fw_id))
s_range <- c(min = min(sim_param$S), max = max(sim_param$S))
c_range <- c(min = min(sim_param$C), max = max(sim_param$C))
k_range <- c(min = min(sim_param$K), max = max(sim_param$K))
```


We used a bioenergetic food-web model to simulate the effects of community
biomass and species richness changes on food-web structure. This food-web model
lifts one of the limitation of our data, that is it includes the biomass of all
the food-webs from primary producers to top predators. This model allows to
simulate complex communities because its parametrization depends mainly on
species bodymasses. We first generated `r nfw` food-webs varying in species
richness (range: `r s_range["min"]`-`r s_range["max"]`)
and connectance (range: `r c_range["min"]`-`r c_range["max"]`) using the niche
model algorithm, which reproduces food-web topology tipically found in empirical
food-webs [@williams_simple_2000]. We set species bodymasses ($M_i$) using a predator-prey
mass ratio of 100 ($Z$) [@brose_allometric_2006; @brose_predator_2019], such as $M_i =
Z^{(TL_i - 1)}$, $TL_i$ being the trophic level of the species $i$. The
metabolic rates of the species ($x_i$) were then derived from allometric
relationships between metabolism and bodymass empirically estimated
[@brose_allometric_2006], such as $x_i = aM_i^b$, with $a = xx$ and $b = -0.25$.

The dynamics of species biomasses are described by an ODE systems of two
equations, for primary producers (eq. \@ref(eq:prod)) and consumers (eq. \@ref(eq:cons)) respectively:

\begin{equation}
    (\#eq:prod)
	\frac{dB_i}{dt} =
    r_i B_i G_i
    - \sum_{j \in \{\mathrm{cons}\}_i} \frac{x_j y_j B_j F_{ji}}{e_{ij}}
\end{equation}

\begin{equation}
    (\#eq:growth)
    G_i = (1 - \dfrac{\sum_{j \in \{\mathrm{prod}\}} \alpha_{ij} B_j}{K_i})
\end{equation}

The primary producer biomass increase with a growth rate ($r_i$) of 1 and a
logistic growth (eq. \@ref(eq:growth)), growth being limited by intraspecific
($\alpha_{ii}$, set to 1), interspecific ($\alpha_{ij}$, set to 0.5) competition,
and carrying capacity ($K_i$, varying in the simulations). Primary producers
loses biomass by being eaten by consumers at a rate that depend on consumer
metabolic rates ($x_j$), attack rates ($y_j$, set to 8 @delmas_analysing_2019),
a functional response (F_{ji}), and assimilation efficiency ($e_{ij}$, set to
0.45 for herbivores and 0.85 for carnivores, @delmas_analysing_2019).

\begin{equation}
    (\#eq:cons)
        \frac{dB_i}{dt} =
        \sum_{j \in \{\mathrm{res}\}_i} x_i y_i B_k F_{ij}
        - \sum_{j \in \{\mathrm{cons}\}_i} \frac{x_j y_j B_j F_{ji}}{e_{ij}}
        - x_i B_i
\end{equation}

Consumers gain biomass by eating other species and lose biomass by being
consumed and by metabolic loses ($x_i$, eq. \@ref(eq:cons)). The functional
response (eq. \@ref(eq:holling)) of consumer feeding depends on the preference
for its preys ($\omega_{ij}$, set even across consumer preys) and
half-saturation rate ($B_0$, set to 0.5). The hill coefficient ($h$, set to 1.5)
determines the shape of the functional response (Holling's type II or III).

\begin{equation}
    (\#eq:holling)
    F_{ij} = \frac{\omega_{ij} B_j^h}
    {B_0^h + \sum_{k \in \{\mathrm{res}\}_i} \omega_{ik} B_k^h}
\end{equation}

We simulated the food-webs dynamics across a gradient of global carrying capacity (K,
range: `r k_range["min"]`-`r k_range["max"]`). The carrying capacity were
standardized according to the number of producers and interspecific competition
($K_i = \frac{1 + \alpha_{ij} (S - 1)}{S}K$) to prevent changes in productivity
due to system size [@ives_stability_2000; @loreau_synchrony_2008]. We ran
simulations for 5000 timesteps. At the end of simulations, we removed dead
species and measured community biomass, species richness and food-web structure.
If the final community contained disconnected producers (i.e. without consumers)
or disconnected consumers (i.e. consumers without preys), we discarded them and
run the simulations again with the same parametrisation. The simulations were
done using the Julia package `EcologicalNetworksDynamics.jl`
[@lajaiiti_ecological_2024].


```{r matmet, fig.cap=fig_mat_cap, out.width="80%"}
knitr::include_graphics(get_mypath("figures", "mat_met.pdf"))
```

# References  {-}

<div id="refs"></div>

\newpage





